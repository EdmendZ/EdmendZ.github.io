<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>OpenGL Advance | TryhardZhang Blog</title><meta name="keywords" content="Graphics"><meta name="author" content="Edmend Zhang"><meta name="copyright" content="Edmend Zhang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="OpenGL Advance"><meta name="application-name" content="OpenGL Advance"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="OpenGL Advance"><meta property="og:url" content="http://example.com/2024/08/16/graphics/opengl/OpenGL%20Advance/index.html"><meta property="og:site_name" content="TryhardZhang Blog"><meta property="og:description" content="OpenGL Advance - Graphics"><meta property="og:locale" content="en"><meta property="og:image" content="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/cover_top_image/Photo%20by%20Aleks%20Marinkovic%20%28jUKpxAfSHlE%29.jpg?_r_=5d68dee6-315f-3b77-cf4f-d639fe02c204"><meta property="article:author" content="Edmend Zhang"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/cover_top_image/Photo%20by%20Aleks%20Marinkovic%20%28jUKpxAfSHlE%29.jpg?_r_=5d68dee6-315f-3b77-cf4f-d639fe02c204"><meta name="description" content="OpenGL Advance - Graphics"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2024/08/16/graphics/opengl/OpenGL%20Advance/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"与数百名博主无限进步","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: 'https://tryhardzhang.netlify.app/.netlify/functions/twikoo',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: {"apiurl":null},
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 游戏数码爱好者","🔍 分享与热心帮助","🏠 桌游剧本杀玩家","🔨 设计开发一条龙","🤝 游戏设计图形学","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: {"appId":"ZFUDQRDP4H","apiKey":"ba6322d83bf3628e149410dca0d696f6","indexName":"hexo","hits":{"per_page":6},"languages":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}.","hits_stats":"${hits} results found in ${time} ms"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"Author: Edmend Zhang","link":"Link: ","source":"Source: TryhardZhang Blog","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source.","copySuccess":"Copy success, copy and reprint please mark the address of this article"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'TryhardZhang Blog',
  title: 'OpenGL Advance',
  postAI: '',
  pageFillDescription: 'OpenGL Advance, 深度测试, 深度值推导, 模板缓存, 高光边缘（选中效果）原理, Blending 效果, 透明的原理, 接口, cullFace表面剔除, 定义面的顶点绘制顺序, 接口, FramBuffer 帧缓存, 创建帧缓存, Texture 作为Buffer附件ColorBuffer, RenderBuffer作为Buffer附件ColorBuffer, FrameBuffer 渲染流程, CubeMap, 接口, 天空盒理论, 天空盒Shader解析, 天空盒优化, 环境贴图, 反射, Shader, 折射, 数据接口, 定点数据拷贝, glMapBuffer 虚拟指针, 顶点数据打包方式, buffer之间的数据拷贝, 内置变量, 接口数据块 Blocks, UniformBlock 显存分配, 全局数据块 Uniform Buffer Object, **shared 默认方式 **, std140, UBO 生成过程, core code 省略后, GeometryShader 几何着色器, 几何着色器原理, 点输入, 三角形输入, Geometry 输出 重新定义了图元装配的类型, GeometryShader, gl_in, 法向量可视化, VertexShader, GeometryShader, 模型读取, 模型材质, Assimp库（读取）, Scene, Child node, Mesh, DrawCall 减少性能开销, gl_InstanceID 内置变量, gl_InstanceID 内置变量 优化 InstanceArray, glVertexAttribDivisor(GLuint index GLuint divisor), Instance 实现, Blin-Phong 光照实现, 半程向量深度测试深度值推导模板缓存高光边缘选中效果原理传入物体材质属性绘制方盒绘制高光边缘渲染高光边缘绘制太阳效果透明的原理接口数据绘制地面绘制方盒绘制窗体为了避免深度缓存的问题我们根据相机的距离先绘制最远的窗体表面剔除解决多余的绘制定义面的顶点绘制顺序接口定义正面是顺时针还是逆时针逆时针方向为正面方向顺时针为正帧缓存帧缓存不是指一块显存而是类似于的一个组织结构他里面包含了很多附件附件里面会根据不同需求开辟不同的显存空间长期以来我们都是用默认的帧缓存来做渲染默认的是号帧缓存创建一个属于我们自己的额外的帧缓存并且利用它来做后处理这种渲染方式为离屏渲染创建帧缓存作为附件作为附件作为作为渲染流程坐标表示纹理坐标系中沿水平轴轴的坐标坐标表示纹理坐标系中沿垂直轴轴的坐标坐标表示与立方体面法线方向相关的深度坐标轴接口天空盒理论天空盒解析直接用物理坐标给纹理坐标赋值天空盒优化环境贴图反射折射数据接口定点数据拷贝向中进行定点数据拷贝进行不同的数据打包方式在不同的之间拷贝数据拷贝的数据指针多次修改数据会造成性能上的浪费每次从内存将数据拷贝到显存虚拟指针顶点数据打包方式之间的数据拷贝从开始读从开始写数据大小内置变量继续渲染丢弃接口数据块显存分配全局数据块变量在显存重点存储方式默认方式生成过程先绑定然后根据绑定两种绑定方式直接绑定绑定范围里有的的生命可以进行绑定省略后数据填充绘制方盒绘制方盒几何着色器几何着色器原理几何着色器对装配的顶点进行生成或减除操作重新定义图元的类型点输入三角形输入每三个一组创建一个将变量放到中输送给输出重新定义了图元装配的类型剪裁距离法向量可视化正常渲染模型使用方式渲染模型得到法向量模型读取模型材质库读取场景根节点模型顶点信息综合模型贴图信息部分模型信息模型块包含构建模型块的所有顶点信息坐标法线索引纹理等模型块数据结构函数构造函数设置函数绘制函数拼装传参字符串位置信息读取法线纹理坐标解析解析材质解析骨骼动画给顶点权重及骨骼解析骨骼构建骨骼减少性能开销使用来做统一将所有渲染任务压入一次性打包绘制的实例数量内置变量代表正在绘制的实例编号从开始依次递增使用会导致过多的使用变量内置变量优化利用顶点数组进行书传书中使用进行的获取挂载锚点绑定数据最多支持所以拆开挂载的锚点多少个实例迭代一次代表一个顶点迭代一次代表一个模型实例绘制迭代一次实现光照设置准备模型变换矩阵光照实现半程向量反射光和人眼的夹角大于九十度导致光线被计算忽略造成偏差',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-08-16 02:54:34',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.1.1"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/20240410162417.png"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">TryhardZhang Blog</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 想法</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?id=9570676565&amp;server=netease"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> Search</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> Newest Comments</span></div><div class="aside-list"><span>loading...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Docker/" style="font-size: 1.05rem;">Docker<sup>2</sup></a><a href="/tags/Games101/" style="font-size: 1.05rem;">Games101<sup>2</sup></a><a href="/tags/Graphics/" style="font-size: 1.05rem;">Graphics<sup>14</sup></a><a href="/tags/Graphics-Games101/" style="font-size: 1.05rem;">Graphics - Games101<sup>1</sup></a><a href="/tags/Home-Assistant-%E9%9B%86%E6%88%90-Frigate-%E5%8A%9F%E8%83%BD%E5%B1%95%E7%A4%BA/" style="font-size: 1.05rem;">Home Assistant 集成 Frigate 功能展示<sup>1</sup></a><a href="/tags/HomeAssistant/" style="font-size: 1.05rem;">HomeAssistant<sup>1</sup></a><a href="/tags/RTP/" style="font-size: 1.05rem;">RTP<sup>1</sup></a><a href="/tags/RTSP/" style="font-size: 1.05rem;">RTSP<sup>3</sup></a><a href="/tags/UE5/" style="font-size: 1.05rem;">UE5<sup>1</sup></a><a href="/tags/VCPKG/" style="font-size: 1.05rem;">VCPKG<sup>1</sup></a><a href="/tags/concepts/" style="font-size: 1.05rem;">concepts<sup>2</sup></a><a href="/tags/csen-272/" style="font-size: 1.05rem;">csen 272<sup>2</sup></a><a href="/tags/live555/" style="font-size: 1.05rem;">live555<sup>1</sup></a><a href="/tags/nlp/" style="font-size: 1.05rem;">nlp<sup>2</sup></a><a href="/tags/search/" style="font-size: 1.05rem;">search<sup>2</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 1.05rem;">博客<sup>1</sup></a><a href="/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/" style="font-size: 1.05rem;">虚拟机<sup>1</sup></a><a href="/tags/%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE%E5%99%A8/" style="font-size: 1.05rem;">视频播放器<sup>1</sup></a><a href="/tags/%E8%A7%86%E9%A2%91%E6%B5%81%E4%BC%A0%E8%BE%93/" style="font-size: 1.05rem;">视频流传输<sup>1</sup></a><a href="/tags/%E8%AF%BE%E7%A8%8B/" style="font-size: 1.05rem;">课程<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>Archives</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">August 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">July 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">22</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">April 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/Graphics/" itemprop="url">Graphics</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Graphics/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Graphics</span></a></span></div></div><h1 class="post-title" itemprop="name headline">OpenGL Advance</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-08-16T02:54:34.748Z" title="Created 2024-08-16 02:54:34">2024-08-16</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-08-16T02:54:34.748Z" title="Updated 2024-08-16 02:54:34">2024-08-16</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span id="" data-flag-title="OpenGL Advance"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">Post View:</span><span id="twikoo_visitors" title="访问量"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为Chengdu"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>Chengdu</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/cover_top_image/Photo%20by%20Aleks%20Marinkovic%20%28jUKpxAfSHlE%29.jpg?_r_=5d68dee6-315f-3b77-cf4f-d639fe02c204"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2024/08/16/graphics/opengl/OpenGL%20Advance/"><header><a class="post-meta-categories" href="/categories/Graphics/" itemprop="url">Graphics</a><a href="/tags/Graphics/" tabindex="-1" itemprop="url">Graphics</a><h1 id="CrawlerTitle" itemprop="name headline">OpenGL Advance</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Edmend Zhang</span><time itemprop="dateCreated datePublished" datetime="2024-08-16T02:54:34.748Z" title="Created 2024-08-16 02:54:34">2024-08-16</time><time itemprop="dateCreated datePublished" datetime="2024-08-16T02:54:34.748Z" title="Updated 2024-08-16 02:54:34">2024-08-16</time></header><h1 id="OpenGL-Advance"><a href="#OpenGL-Advance" class="headerlink" title="OpenGL Advance"></a>OpenGL Advance</h1><h2 id="深度测试"><a href="#深度测试" class="headerlink" title="深度测试"></a>深度测试</h2><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240805105725325.png" alt="image-20240805105725325" style="zoom:67%;" />

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240805110129172.png" alt="image-20240805110129172" style="zoom: 67%;" /><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240805110153360.png" alt="image-20240805110153360"></p>
<h3 id="深度值推导"><a href="#深度值推导" class="headerlink" title="深度值推导"></a>深度值推导</h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240805110451436.png" alt="image-20240805110451436" style="zoom:67%;" />

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240805111959130.png" alt="image-20240805111959130" style="zoom:67%;" />

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240805113424885.png" alt="image-20240805113424885" style="zoom:67%;" />

<h3 id="模板缓存"><a href="#模板缓存" class="headerlink" title="模板缓存"></a>模板缓存</h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240805113950797.png" alt="image-20240805113950797" style="zoom:67%;" />

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240805114233315.png" alt="image-20240805114233315" style="zoom:67%;" />

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240805120746860.png" alt="image-20240805120746860" style="zoom: 67%;" />

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240805120819073.png" alt="image-20240805120819073"></p>
<h3 id="高光边缘（选中效果）原理"><a href="#高光边缘（选中效果）原理" class="headerlink" title="高光边缘（选中效果）原理"></a>高光边缘（选中效果）原理</h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240805122519342.png" alt="image-20240805122519342" style="zoom:67%;" />

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">rend</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">    <span class="built_in">glEnable</span>(GL_STENCIL_TEST);</span><br><span class="line">    <span class="built_in">glStencilMask</span>(<span class="number">0xFF</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glClearColor</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>);</span><br><span class="line">    <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT | GL_STENCIL_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">    glm::vec3 cubePositions[] = &#123;</span><br><span class="line">    glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>,  <span class="number">0.0f</span>,  <span class="number">0.0f</span>),</span><br><span class="line">    glm::<span class="built_in">vec3</span>(<span class="number">2.0f</span>,  <span class="number">5.0f</span>, <span class="number">-15.0f</span>),</span><br><span class="line">    glm::<span class="built_in">vec3</span>(<span class="number">-1.5f</span>, <span class="number">-2.2f</span>, <span class="number">-2.5f</span>),</span><br><span class="line">    glm::<span class="built_in">vec3</span>(<span class="number">-3.8f</span>, <span class="number">-2.0f</span>, <span class="number">-12.3f</span>),</span><br><span class="line">    glm::<span class="built_in">vec3</span>(<span class="number">2.4f</span>, <span class="number">-0.4f</span>, <span class="number">-3.5f</span>),</span><br><span class="line">    glm::<span class="built_in">vec3</span>(<span class="number">-1.7f</span>,  <span class="number">3.0f</span>, <span class="number">-7.5f</span>),</span><br><span class="line">    glm::<span class="built_in">vec3</span>(<span class="number">1.3f</span>, <span class="number">-2.0f</span>, <span class="number">-2.5f</span>),</span><br><span class="line">    glm::<span class="built_in">vec3</span>(<span class="number">1.5f</span>,  <span class="number">2.0f</span>, <span class="number">-2.5f</span>),</span><br><span class="line">    glm::<span class="built_in">vec3</span>(<span class="number">1.5f</span>,  <span class="number">0.2f</span>, <span class="number">-1.5f</span>),</span><br><span class="line">    glm::<span class="built_in">vec3</span>(<span class="number">-1.3f</span>,  <span class="number">1.0f</span>, <span class="number">-1.5f</span>)</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    glm::vec3 pointLightPositions[] = &#123;</span><br><span class="line">    glm::<span class="built_in">vec3</span>(<span class="number">0.7f</span>,  <span class="number">0.2f</span>,  <span class="number">2.0f</span>),</span><br><span class="line">    glm::<span class="built_in">vec3</span>(<span class="number">2.3f</span>, <span class="number">-3.3f</span>, <span class="number">-4.0f</span>),</span><br><span class="line">    glm::<span class="built_in">vec3</span>(<span class="number">-4.0f</span>,  <span class="number">2.0f</span>, <span class="number">-12.0f</span>),</span><br><span class="line">    glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>,  <span class="number">0.0f</span>, <span class="number">-3.0f</span>)</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    _camera.<span class="built_in">update</span>();</span><br><span class="line">    _projMatrix = glm::<span class="built_in">perspective</span>(glm::<span class="built_in">radians</span>(<span class="number">45.0f</span>), (<span class="type">float</span>)_width / (<span class="type">float</span>)_height, <span class="number">0.1f</span>, <span class="number">100.0f</span>);</span><br><span class="line">    glm::mat4 _modelMatrix(<span class="number">1.0f</span>);</span><br><span class="line">    _modelMatrix = glm::<span class="built_in">translate</span>(_modelMatrix, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-3.0f</span>));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glActiveTexture</span>(GL_TEXTURE0);</span><br><span class="line">    <span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, _textureBox);</span><br><span class="line">    <span class="built_in">glActiveTexture</span>(GL_TEXTURE1);</span><br><span class="line">    <span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, _textureSpec);</span><br><span class="line"></span><br><span class="line">    _shader_scene.<span class="built_in">start</span>();</span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;view_pos&quot;</span>, _camera.<span class="built_in">getPosition</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//传入物体材质属性</span></span><br><span class="line">    _shader_scene.<span class="built_in">setInt</span>(<span class="string">&quot;myMaterial.m_specular&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    _shader_scene.<span class="built_in">setFloat</span>(<span class="string">&quot;myMaterial.m_shiness&quot;</span>, <span class="number">32</span>);</span><br><span class="line"></span><br><span class="line">    _shader_scene.<span class="built_in">setMatrix</span>(<span class="string">&quot;_viewMatrix&quot;</span>, _camera.<span class="built_in">getMatrix</span>());</span><br><span class="line">    _shader_scene.<span class="built_in">setMatrix</span>(<span class="string">&quot;_projMatrix&quot;</span>, _projMatrix);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// directional light</span></span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_dirLight.m_direction&quot;</span>, glm::<span class="built_in">vec3</span>(<span class="number">-0.2f</span>, <span class="number">-1.0f</span>, <span class="number">-0.3f</span>));</span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_dirLight.m_ambient&quot;</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.05f</span>, <span class="number">0.05f</span>, <span class="number">0.05f</span>));</span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_dirLight.m_diffuse&quot;</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.4f</span>, <span class="number">0.4f</span>, <span class="number">0.4f</span>));</span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_dirLight.m_specular&quot;</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.5f</span>, <span class="number">0.5f</span>, <span class="number">0.5f</span>));</span><br><span class="line">    <span class="comment">// point light 1</span></span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_pointLight[0].m_pos&quot;</span>, pointLightPositions[<span class="number">0</span>]);</span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_pointLight[0].m_ambient&quot;</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.05f</span>, <span class="number">0.05f</span>, <span class="number">0.05f</span>));</span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_pointLight[0].m_diffuse&quot;</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.8f</span>, <span class="number">0.8f</span>, <span class="number">0.8f</span>));</span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_pointLight[0].m_specular&quot;</span>, glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line">    _shader_scene.<span class="built_in">setFloat</span>(<span class="string">&quot;_pointLight[0].m_c&quot;</span>, <span class="number">1.0f</span>);</span><br><span class="line">    _shader_scene.<span class="built_in">setFloat</span>(<span class="string">&quot;_pointLight[0].m_l&quot;</span>, <span class="number">0.09</span>);</span><br><span class="line">    _shader_scene.<span class="built_in">setFloat</span>(<span class="string">&quot;_pointLight[0].m_q&quot;</span>, <span class="number">0.032</span>);</span><br><span class="line">    <span class="comment">// point light 2</span></span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_pointLight[1].m_pos&quot;</span>, pointLightPositions[<span class="number">1</span>]);</span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_pointLight[1].m_ambient&quot;</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.05f</span>, <span class="number">0.05f</span>, <span class="number">0.05f</span>));</span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_pointLight[1].m_diffuse&quot;</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.8f</span>, <span class="number">0.8f</span>, <span class="number">0.8f</span>));</span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_pointLight[1].m_specular&quot;</span>, glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line">    _shader_scene.<span class="built_in">setFloat</span>(<span class="string">&quot;_pointLight[1].m_c&quot;</span>, <span class="number">1.0f</span>);</span><br><span class="line">    _shader_scene.<span class="built_in">setFloat</span>(<span class="string">&quot;_pointLight[1].m_l&quot;</span>, <span class="number">0.09</span>);</span><br><span class="line">    _shader_scene.<span class="built_in">setFloat</span>(<span class="string">&quot;_pointLight[1].m_q&quot;</span>, <span class="number">0.032</span>);</span><br><span class="line">    <span class="comment">// point light 3</span></span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_pointLight[2].m_pos&quot;</span>, pointLightPositions[<span class="number">2</span>]);</span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_pointLight[2].m_ambient&quot;</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.05f</span>, <span class="number">0.05f</span>, <span class="number">0.05f</span>));</span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_pointLight[2].m_diffuse&quot;</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.8f</span>, <span class="number">0.8f</span>, <span class="number">0.8f</span>));</span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_pointLight[2].m_specular&quot;</span>, glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line">    _shader_scene.<span class="built_in">setFloat</span>(<span class="string">&quot;_pointLight[2].m_c&quot;</span>, <span class="number">1.0f</span>);</span><br><span class="line">    _shader_scene.<span class="built_in">setFloat</span>(<span class="string">&quot;_pointLight[2].m_l&quot;</span>, <span class="number">0.09</span>);</span><br><span class="line">    _shader_scene.<span class="built_in">setFloat</span>(<span class="string">&quot;_pointLight[2].m_q&quot;</span>, <span class="number">0.032</span>);</span><br><span class="line">    <span class="comment">// point light 4</span></span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_pointLight[3].m_pos&quot;</span>, pointLightPositions[<span class="number">3</span>]);</span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_pointLight[3].m_ambient&quot;</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.05f</span>, <span class="number">0.05f</span>, <span class="number">0.05f</span>));</span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_pointLight[3].m_diffuse&quot;</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.8f</span>, <span class="number">0.8f</span>, <span class="number">0.8f</span>));</span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_pointLight[3].m_specular&quot;</span>, glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line">    _shader_scene.<span class="built_in">setFloat</span>(<span class="string">&quot;_pointLight[3].m_c&quot;</span>, <span class="number">1.0f</span>);</span><br><span class="line">    _shader_scene.<span class="built_in">setFloat</span>(<span class="string">&quot;_pointLight[3].m_l&quot;</span>, <span class="number">0.09</span>);</span><br><span class="line">    _shader_scene.<span class="built_in">setFloat</span>(<span class="string">&quot;_pointLight[3].m_q&quot;</span>, <span class="number">0.032</span>);</span><br><span class="line">    <span class="comment">// spotLight</span></span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_spotLight.m_pos&quot;</span>, _camera.<span class="built_in">getPosition</span>());</span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_spotLight.m_direction&quot;</span>, _camera.<span class="built_in">getDirection</span>());</span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_spotLight.m_ambient&quot;</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_spotLight.m_diffuse&quot;</span>, glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line">    _shader_scene.<span class="built_in">setVec3</span>(<span class="string">&quot;_spotLight.m_specular&quot;</span>, glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line">    _shader_scene.<span class="built_in">setFloat</span>(<span class="string">&quot;_spotLight.m_c&quot;</span>, <span class="number">1.0f</span>);</span><br><span class="line">    _shader_scene.<span class="built_in">setFloat</span>(<span class="string">&quot;_spotLight.m_l&quot;</span>, <span class="number">0.09</span>);</span><br><span class="line">    _shader_scene.<span class="built_in">setFloat</span>(<span class="string">&quot;_spotLight.m_q&quot;</span>, <span class="number">0.032</span>);</span><br><span class="line">    _shader_scene.<span class="built_in">setFloat</span>(<span class="string">&quot;_spotLight.m_cutOff&quot;</span>, glm::<span class="built_in">cos</span>(glm::<span class="built_in">radians</span>(<span class="number">12.5f</span>)));</span><br><span class="line">    _shader_scene.<span class="built_in">setFloat</span>(<span class="string">&quot;_spotLight.m_outCutOff&quot;</span>, glm::<span class="built_in">cos</span>(glm::<span class="built_in">radians</span>(<span class="number">15.0f</span>)));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//////绘制方盒</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">glStencilFunc</span>(GL_ALWAYS, <span class="number">1</span>, <span class="number">0xFF</span>);</span><br><span class="line">        <span class="built_in">glStencilMask</span>(<span class="number">0x00</span>);</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">4</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">glStencilFunc</span>(GL_ALWAYS, <span class="number">1</span>, <span class="number">0xFF</span>);</span><br><span class="line">            <span class="built_in">glStencilMask</span>(<span class="number">0xFF</span>);</span><br><span class="line">            <span class="built_in">glStencilOp</span>(GL_KEEP, GL_KEEP, GL_REPLACE);</span><br><span class="line">        &#125;</span><br><span class="line">        _modelMatrix = glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>);</span><br><span class="line">        _modelMatrix = glm::<span class="built_in">translate</span>(_modelMatrix, cubePositions[i]);</span><br><span class="line">        _modelMatrix = glm::<span class="built_in">rotate</span>(_modelMatrix, glm::<span class="built_in">radians</span>(i * <span class="number">20.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));Fre</span><br><span class="line"></span><br><span class="line">        _shader_scene.<span class="built_in">setMatrix</span>(<span class="string">&quot;_modelMatrix&quot;</span>, _modelMatrix);</span><br><span class="line">        <span class="built_in">glBindVertexArray</span>(VAO_cube);</span><br><span class="line">        <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _shader_scene.<span class="built_in">end</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//绘制高光边缘</span></span><br><span class="line">    _shader_color.<span class="built_in">start</span>();</span><br><span class="line">    _shader_color.<span class="built_in">setMatrix</span>(<span class="string">&quot;_viewMatrix&quot;</span>, _camera.<span class="built_in">getMatrix</span>());</span><br><span class="line">    _shader_color.<span class="built_in">setMatrix</span>(<span class="string">&quot;_projMatrix&quot;</span>, _projMatrix);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//////渲染高光边缘</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">glStencilFunc</span>(GL_NEVER, <span class="number">1</span>, <span class="number">0xFF</span>);</span><br><span class="line">        <span class="built_in">glStencilMask</span>(<span class="number">0x00</span>);</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">4</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">glStencilFunc</span>(GL_NOTEQUAL, <span class="number">1</span>, <span class="number">0xFF</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        _modelMatrix = glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>);</span><br><span class="line">        _modelMatrix = glm::<span class="built_in">translate</span>(_modelMatrix, cubePositions[i]);</span><br><span class="line">        _modelMatrix = glm::<span class="built_in">rotate</span>(_modelMatrix, glm::<span class="built_in">radians</span>(i * <span class="number">20.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">        _modelMatrix = glm::<span class="built_in">scale</span>(_modelMatrix, glm::<span class="built_in">vec3</span>(<span class="number">1.1f</span>, <span class="number">1.1f</span>, <span class="number">1.1f</span>));</span><br><span class="line"></span><br><span class="line">        _shader_color.<span class="built_in">setMatrix</span>(<span class="string">&quot;_modelMatrix&quot;</span>, _modelMatrix);</span><br><span class="line">        <span class="built_in">glBindVertexArray</span>(VAO_cube);</span><br><span class="line">        <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    _shader_color.<span class="built_in">end</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glStencilFunc</span>(GL_ALWAYS, <span class="number">1</span>, <span class="number">0xFF</span>);</span><br><span class="line">    <span class="comment">//////绘制太阳</span></span><br><span class="line">    _shader_sun.<span class="built_in">start</span>();</span><br><span class="line">    _shader_sun.<span class="built_in">setMatrix</span>(<span class="string">&quot;_viewMatrix&quot;</span>, _camera.<span class="built_in">getMatrix</span>());</span><br><span class="line">    _shader_sun.<span class="built_in">setMatrix</span>(<span class="string">&quot;_projMatrix&quot;</span>, _projMatrix);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        _modelMatrix = glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>);</span><br><span class="line">        _modelMatrix = glm::<span class="built_in">translate</span>(_modelMatrix, pointLightPositions[i]);</span><br><span class="line">        _modelMatrix = glm::<span class="built_in">scale</span>(_modelMatrix, glm::<span class="built_in">vec3</span>(<span class="number">0.2f</span>, <span class="number">0.2f</span>, <span class="number">0.2f</span>));</span><br><span class="line">        _shader_sun.<span class="built_in">setMatrix</span>(<span class="string">&quot;_modelMatrix&quot;</span>, _modelMatrix);</span><br><span class="line">        <span class="built_in">glBindVertexArray</span>(VAO_sun);</span><br><span class="line">        <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _shader_sun.<span class="built_in">end</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Blending-效果"><a href="#Blending-效果" class="headerlink" title="Blending 效果"></a>Blending 效果</h2><h3 id="透明的原理"><a href="#透明的原理" class="headerlink" title="透明的原理"></a>透明的原理</h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240805150530894.png" alt="image-20240805150530894" style="zoom:67%;" />

<h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240805151056397.png" alt="image-20240805151056397"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">rend</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//数据</span></span><br><span class="line">    std::vector&lt;glm::vec3&gt; _window_pos</span><br><span class="line">    &#123;</span><br><span class="line">        glm::<span class="built_in">vec3</span>(<span class="number">-1.5f</span>, <span class="number">0.0f</span>, <span class="number">-0.48f</span>),</span><br><span class="line">        glm::<span class="built_in">vec3</span>(<span class="number">1.5f</span>, <span class="number">0.0f</span>, <span class="number">0.51f</span>),</span><br><span class="line">        glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.7f</span>),</span><br><span class="line">        glm::<span class="built_in">vec3</span>(<span class="number">-0.3f</span>, <span class="number">0.0f</span>, <span class="number">-2.3f</span>),</span><br><span class="line">        glm::<span class="built_in">vec3</span>(<span class="number">0.5f</span>, <span class="number">0.0f</span>, <span class="number">-0.6f</span>)</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    std::map&lt;<span class="type">float</span>, glm::vec3&gt; _window_sort;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; _window_pos.<span class="built_in">size</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">float</span> _dist = glm::<span class="built_in">length</span>(_camera.<span class="built_in">getPosition</span>() - _window_pos[i]);</span><br><span class="line">        _window_sort[_dist] = _window_pos[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glClearColor</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>);</span><br><span class="line">    <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</span><br><span class="line">    <span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line">    <span class="built_in">glEnable</span>(GL_BLEND);</span><br><span class="line">    <span class="built_in">glBlendFunc</span>(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    _camera.<span class="built_in">update</span>();</span><br><span class="line">    _projMatrix = glm::<span class="built_in">perspective</span>(glm::<span class="built_in">radians</span>(<span class="number">45.0f</span>), (<span class="type">float</span>)_width / (<span class="type">float</span>)_height, <span class="number">0.1f</span>, <span class="number">100.0f</span>);</span><br><span class="line">    glm::mat4 _modelMatrix(<span class="number">1.0f</span>);</span><br><span class="line">    _modelMatrix = glm::<span class="built_in">translate</span>(_modelMatrix, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-3.0f</span>));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glActiveTexture</span>(GL_TEXTURE0);</span><br><span class="line">    <span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, _textureBox);</span><br><span class="line"></span><br><span class="line">    _shader.<span class="built_in">start</span>();</span><br><span class="line">    _shader.<span class="built_in">setMatrix</span>(<span class="string">&quot;_modelMatrix&quot;</span>, _modelMatrix);</span><br><span class="line">    _shader.<span class="built_in">setMatrix</span>(<span class="string">&quot;_viewMatrix&quot;</span>, _camera.<span class="built_in">getMatrix</span>());</span><br><span class="line">    _shader.<span class="built_in">setMatrix</span>(<span class="string">&quot;_projMatrix&quot;</span>, _projMatrix);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//绘制地面</span></span><br><span class="line">    <span class="built_in">glBindVertexArray</span>(VAO_plane);</span><br><span class="line">    <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//绘制方盒</span></span><br><span class="line">    <span class="built_in">glBindVertexArray</span>(VAO_cube);</span><br><span class="line">    <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//绘制窗体</span></span><br><span class="line">    <span class="keyword">for</span> (std::map&lt;<span class="type">float</span>, glm::vec3&gt;::reverse_iterator _it = _window_sort.<span class="built_in">rbegin</span>(); _it != _window_sort.<span class="built_in">rend</span>(); _it++)</span><br><span class="line">    &#123;</span><br><span class="line">        _modelMatrix = glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>);</span><br><span class="line">        _modelMatrix = glm::<span class="built_in">translate</span>(_modelMatrix, _it-&gt;second);</span><br><span class="line">        _shader.<span class="built_in">setMatrix</span>(<span class="string">&quot;_modelMatrix&quot;</span>, _modelMatrix);</span><br><span class="line">        <span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, _textureWindow);</span><br><span class="line">        <span class="built_in">glBindVertexArray</span>(VAO_window);</span><br><span class="line">        <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _shader.<span class="built_in">end</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">uint <span class="title">createPlane</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    uint _VAO = <span class="number">0</span>;</span><br><span class="line">    uint _VBO = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">glGenVertexArrays</span>(<span class="number">1</span>, &amp;_VAO);</span><br><span class="line">    <span class="built_in">glBindVertexArray</span>(_VAO);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glGenBuffers</span>(<span class="number">1</span>, &amp;_VBO);</span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, _VBO);</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> planeVertices[] = &#123;</span><br><span class="line">         <span class="number">5.0f</span>, <span class="number">-0.5f</span>,  <span class="number">5.0f</span>,  <span class="number">2.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">-5.0f</span>, <span class="number">-0.5f</span>,  <span class="number">5.0f</span>,  <span class="number">0.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">-5.0f</span>, <span class="number">-0.5f</span>, <span class="number">-5.0f</span>,  <span class="number">0.0f</span>, <span class="number">2.0f</span>,</span><br><span class="line"></span><br><span class="line">         <span class="number">5.0f</span>, <span class="number">-0.5f</span>,  <span class="number">5.0f</span>,  <span class="number">2.0f</span>, <span class="number">0.0f</span>,</span><br><span class="line">        <span class="number">-5.0f</span>, <span class="number">-0.5f</span>, <span class="number">-5.0f</span>,  <span class="number">0.0f</span>, <span class="number">2.0f</span>,</span><br><span class="line">         <span class="number">5.0f</span>, <span class="number">-0.5f</span>, <span class="number">-5.0f</span>,  <span class="number">2.0f</span>, <span class="number">2.0f</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(planeVertices), planeVertices, GL_STATIC_DRAW);</span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(<span class="number">0</span>, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="number">5</span> * <span class="built_in">sizeof</span>(<span class="type">float</span>), (<span class="type">void</span>*)<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">glVertexAttribPointer</span>(<span class="number">1</span>, <span class="number">2</span>, GL_FLOAT, GL_FALSE, <span class="number">5</span> * <span class="built_in">sizeof</span>(<span class="type">float</span>), (<span class="type">void</span>*)(<span class="number">3</span> * <span class="built_in">sizeof</span>(<span class="type">float</span>)));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> _VAO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>为了避免深度缓存的问题 我们根据相机的距离先绘制最远的窗体</strong></p>
<h2 id="cullFace表面剔除"><a href="#cullFace表面剔除" class="headerlink" title="cullFace表面剔除"></a>cullFace表面剔除</h2><p><strong>解决多余的绘制</strong></p>
<h3 id="定义面的顶点绘制顺序"><a href="#定义面的顶点绘制顺序" class="headerlink" title="定义面的顶点绘制顺序"></a>定义面的顶点绘制顺序</h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240805165408784.png" alt="image-20240805165408784" style="zoom:67%;" />

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240805165557730.png" alt="image-20240805165557730" style="zoom: 67%;" />

<h3 id="接口-1"><a href="#接口-1" class="headerlink" title="接口"></a>接口</h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240805165658523.png" alt="image-20240805165658523" style="zoom:67%;" />

<p>glFrontFace 定义正面是顺时针还是逆时针</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">glClearColor</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>);</span><br><span class="line"><span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line"><span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line"></span><br><span class="line"><span class="built_in">glEnable</span>(GL_CULL_FACE);</span><br><span class="line"><span class="built_in">glFrontFace</span>(GL_CCW); <span class="comment">// GL_CCW 逆时针方向为正面方向 GL_CW 顺时针为正</span></span><br></pre></td></tr></table></figure>

<h2 id="FramBuffer-帧缓存"><a href="#FramBuffer-帧缓存" class="headerlink" title="FramBuffer 帧缓存"></a>FramBuffer 帧缓存</h2><p>帧缓存不是指一块显存,而是类似于VAO的一个组织结构,他里面包含了很多附件<br>(ColorBuffer,DepthBuffer,StencilBuffer),附件里面会根据不同需求开辟不同的<br>显存空间</p>
<p>长期以来,我们都是用默认的帧缓存来做渲染,默认的是0号帧缓存</p>
<p>创建一个属于我们自己的额外的帧缓存,并且利用它来做后处<br>理(Post-Process),这种渲染方式为离屏渲染(off-screen rending)</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240805173315575.png" alt="image-20240805173315575" style="zoom:67%;" />

<h3 id="创建帧缓存"><a href="#创建帧缓存" class="headerlink" title="创建帧缓存"></a>创建帧缓存</h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240806113707384.png" alt="image-20240806113707384" style="zoom: 67%;" />

<h3 id="Texture-作为Buffer附件ColorBuffer"><a href="#Texture-作为Buffer附件ColorBuffer" class="headerlink" title="Texture 作为Buffer附件ColorBuffer"></a>Texture 作为Buffer附件ColorBuffer</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240806115623186.png" alt="image-20240806115623186"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240806115905331.png" alt="image-20240806115905331"></p>
<h3 id="RenderBuffer作为Buffer附件ColorBuffer"><a href="#RenderBuffer作为Buffer附件ColorBuffer" class="headerlink" title="RenderBuffer作为Buffer附件ColorBuffer"></a>RenderBuffer作为Buffer附件ColorBuffer</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240806120410613.png" alt="image-20240806120410613"></p>
<p>Texture作为ColorBuffer，RenderBuffer作为D&#x2F;S Buffer</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240806120326003.png" alt="image-20240806120326003"></p>
<h3 id="FrameBuffer-渲染流程"><a href="#FrameBuffer-渲染流程" class="headerlink" title="FrameBuffer 渲染流程"></a>FrameBuffer 渲染流程</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240806120721581.png" alt="image-20240806120721581"></p>
<h2 id="CubeMap"><a href="#CubeMap" class="headerlink" title="CubeMap"></a>CubeMap</h2><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240806150510384.png" alt="image-20240806150510384" style="zoom:67%;" />

<p><strong>s 坐标</strong>: 表示纹理坐标系中沿水平轴（X 轴）的坐标。</p>
<p><strong>t 坐标</strong>: 表示纹理坐标系中沿垂直轴（Y 轴）的坐标。</p>
<p><strong>r 坐标</strong>: 表示与立方体面法线方向相关的深度坐标（Z 轴）。</p>
<h3 id="接口-2"><a href="#接口-2" class="headerlink" title="接口"></a>接口</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240806150757157.png" alt="image-20240806150757157"></p>
<h3 id="天空盒理论"><a href="#天空盒理论" class="headerlink" title="天空盒理论"></a>天空盒理论</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240806152047616.png" alt="image-20240806152047616"></p>
<h3 id="天空盒Shader解析"><a href="#天空盒Shader解析" class="headerlink" title="天空盒Shader解析"></a>天空盒Shader解析</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240806152555557.png"></p>
<p>直接用物理坐标给纹理坐标赋值</p>
<h3 id="天空盒优化"><a href="#天空盒优化" class="headerlink" title="天空盒优化"></a>天空盒优化</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240806162208165.png" alt="image-20240806162208165"></p>
<h2 id="环境贴图"><a href="#环境贴图" class="headerlink" title="环境贴图"></a>环境贴图</h2><h3 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240806165529599.png" alt="image-20240806165529599"></p>
<h3 id="Shader"><a href="#Shader" class="headerlink" title="Shader"></a>Shader</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240806165716795.png" alt="image-20240806165716795"></p>
<p><em><em>Normal &#x3D; mat3（transpose（inverse（model）））</em> aNormal</em>*</p>
<h3 id="折射"><a href="#折射" class="headerlink" title="折射"></a>折射</h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240806174008672.png" alt="image-20240806174008672" style="zoom: 50%;" />

<h2 id="数据接口"><a href="#数据接口" class="headerlink" title="数据接口"></a>数据接口</h2><h3 id="定点数据拷贝"><a href="#定点数据拷贝" class="headerlink" title="定点数据拷贝"></a>定点数据拷贝</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">glBufferSubData</span>(GL_ARRAY_BUFFER, <span class="number">24</span> <span class="built_in">sizeof</span>(data), &amp;data);</span><br></pre></td></tr></table></figure>

<ol>
<li><p><strong>向Buffer中进行定点数据拷贝</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240809172329603.png"></p>
</li>
<li><p><strong>进行不同的数据打包方式</strong></p>
</li>
<li><p><strong>在不同的buffer之间拷贝数据</strong></p>
</li>
<li><p><strong>拷贝的数据指针</strong></p>
</li>
</ol>
<p><strong>多次修改数据，会造成性能上的浪费， 每次从内存将数据拷贝到显存</strong></p>
<h3 id="glMapBuffer-虚拟指针"><a href="#glMapBuffer-虚拟指针" class="headerlink" title="glMapBuffer 虚拟指针"></a>glMapBuffer 虚拟指针</h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240812102644240.png" alt="image-20240812102644240" style="zoom:67%;" />

<h3 id="顶点数据打包方式"><a href="#顶点数据打包方式" class="headerlink" title="顶点数据打包方式"></a>顶点数据打包方式</h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240812103621644.png" alt="image-20240812103621644" style="zoom:67%;" />

<h3 id="buffer之间的数据拷贝"><a href="#buffer之间的数据拷贝" class="headerlink" title="buffer之间的数据拷贝"></a>buffer之间的数据拷贝</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">glBindBuffer</span>(GL_COPY_READ_BUFFER, vbo1)</span><br><span class="line"><span class="built_in">glBindBuffer</span>(GL_COPy_WRITE_BUFFER, vbo2)</span><br><span class="line"><span class="built_in">glCopyBufferSubData</span>(GL_COPY_READ_BUFFER, GL_COPY_WIRTE_BBUFFER, <span class="number">0</span>, <span class="number">0</span>, <span class="number">8</span>*<span class="built_in">sizeof</span>(<span class="type">float</span>)) <span class="comment">// 从read 0 开始读，从write 0 开始写， 数据大小</span></span><br></pre></td></tr></table></figure>

<h3 id="内置变量"><a href="#内置变量" class="headerlink" title="内置变量"></a>内置变量</h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240812104147630.png" alt="image-20240812104147630" style="zoom: 67%;" />

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240812104844360.png" alt="image-20240812104844360" style="zoom: 67%;" />

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240812105017535.png" alt="image-20240812105017535" style="zoom: 67%;" />

<ul>
<li><strong>return；继续渲染</strong></li>
<li><strong>discard；丢弃</strong></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240812111355755.png" alt="image-20240812111355755"></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240812113518916.png" alt="image-20240812113518916" style="zoom:67%;" />

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240812113801772.png" alt="image-20240812113801772" style="zoom:67%;" />

<h3 id="接口数据块-Blocks"><a href="#接口数据块-Blocks" class="headerlink" title="接口数据块 Blocks"></a>接口数据块 Blocks</h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240812113941818.png" alt="image-20240812113941818" style="zoom:67%;" />

<h2 id="UniformBlock-显存分配"><a href="#UniformBlock-显存分配" class="headerlink" title="UniformBlock 显存分配"></a>UniformBlock 显存分配</h2><h3 id="全局数据块-Uniform-Buffer-Object"><a href="#全局数据块-Uniform-Buffer-Object" class="headerlink" title="全局数据块 Uniform Buffer Object"></a>全局数据块 Uniform Buffer Object</h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240812114647190.png" alt="image-20240812114647190" style="zoom:67%;" />

<p>Uniform变量在UBO显存重点存储方式：Shared，std140，packed，std430</p>
<h3 id="shared-默认方式"><a href="#shared-默认方式" class="headerlink" title="**shared 默认方式 **"></a>**shared 默认方式 **</h3><h3 id="std140"><a href="#std140" class="headerlink" title="std140"></a><strong>std140</strong></h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240812122919238.png" alt="image-20240812122919238" style="zoom:67%;" />

<h3 id="UBO-生成过程"><a href="#UBO-生成过程" class="headerlink" title="UBO 生成过程"></a>UBO 生成过程</h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240812153754072.png" alt="image-20240812153754072" style="zoom:67%;" />

<p>先绑定UBO 然后根据UBO绑定Shader</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UBO两种绑定方式</span></span><br><span class="line"><span class="built_in">glBindBufferBase</span>(GL_UNIFORM_BUFFER, <span class="number">2</span>, uboExampleBlock);			<span class="comment">// 直接绑定</span></span><br><span class="line"><span class="built_in">glBindBufferRange</span>(GL_UNIFORM_BUFFER, <span class="number">2</span>, uboExampleBlock, <span class="number">0</span>, <span class="number">152</span>);	<span class="comment">// 绑定范围</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Shader里有Light的uniform block的生命， 可以进行绑定</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> lights_index = <span class="built_in">glGetUniformBlockIndex</span>(shaderA.ID, <span class="string">&quot;Lights&quot;</span>);</span><br><span class="line"><span class="built_in">glUniformBlockBinding</span>(shaderA.ID, lights_index, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<h3 id="core-code-省略后"><a href="#core-code-省略后" class="headerlink" title="core code 省略后"></a>core code 省略后</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// init shader</span></span><br><span class="line">Shader          _shader;</span><br><span class="line">Shader          _shader_red;</span><br><span class="line">Shader          _shader_green;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initShader</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    _shader.<span class="built_in">initShader</span>(<span class="string">&quot;shader/vertexShader.glsl&quot;</span>, <span class="string">&quot;shader/fragmentShader.glsl&quot;</span>);</span><br><span class="line">    _shader_red.<span class="built_in">initShader</span>(<span class="string">&quot;shader/redShaderv.glsl&quot;</span>, <span class="string">&quot;shader/redShaderf.glsl&quot;</span>);</span><br><span class="line">    _shader_green.<span class="built_in">initShader</span>(<span class="string">&quot;shader/greenShaderv.glsl&quot;</span>, <span class="string">&quot;shader/greenShaderf.glsl&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">uint <span class="title">createUBO</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    uint _ubo = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">glGenBuffers</span>(<span class="number">1</span>, &amp;_ubo);</span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_UNIFORM_BUFFER, _ubo);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_UNIFORM_BUFFER, <span class="number">2</span> * <span class="built_in">sizeof</span>(glm::mat4), <span class="literal">NULL</span>, GL_DYNAMIC_DRAW);</span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_UNIFORM_BUFFER, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> _ubo;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bindShaderData</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">glBindBufferBase</span>(GL_UNIFORM_BUFFER, <span class="number">0</span>, UBO);</span><br><span class="line"></span><br><span class="line">    uint redIndex = <span class="built_in">glGetUniformBlockIndex</span>(_shader_red.<span class="built_in">getProgram</span>(), <span class="string">&quot;MAT&quot;</span>);</span><br><span class="line">    <span class="built_in">glUniformBlockBinding</span>(_shader_red.<span class="built_in">getProgram</span>(), redIndex, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    uint greenIndex = <span class="built_in">glGetUniformBlockIndex</span>(_shader_green.<span class="built_in">getProgram</span>(), <span class="string">&quot;MAT&quot;</span>);</span><br><span class="line">    <span class="built_in">glUniformBlockBinding</span>(_shader_green.<span class="built_in">getProgram</span>(), greenIndex, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rend</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//uniform 数据填充</span></span><br><span class="line">    <span class="built_in">glBufferSubData</span>(GL_UNIFORM_BUFFER, <span class="number">0</span>, <span class="built_in">sizeof</span>(glm::mat4), glm::<span class="built_in">value_ptr</span>(_projMatrix));</span><br><span class="line">    <span class="built_in">glBufferSubData</span>(GL_UNIFORM_BUFFER, <span class="built_in">sizeof</span>(glm::mat4), <span class="built_in">sizeof</span>(glm::mat4), glm::<span class="built_in">value_ptr</span>(_camera.<span class="built_in">getMatrix</span>()));</span><br><span class="line"></span><br><span class="line">    _shader_red.<span class="built_in">start</span>();</span><br><span class="line">    _shader_red.<span class="built_in">setMatrix</span>(<span class="string">&quot;_modelMatrix&quot;</span>, _modelMatrix);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//绘制方盒</span></span><br><span class="line">    <span class="built_in">glBindVertexArray</span>(VAO_cube);</span><br><span class="line">    <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line">    _shader_red.<span class="built_in">end</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    _shader_green.<span class="built_in">start</span>();</span><br><span class="line">    _modelMatrix = glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>);</span><br><span class="line">    _modelMatrix = glm::<span class="built_in">translate</span>(_modelMatrix, glm::<span class="built_in">vec3</span>(<span class="number">2.0f</span>, <span class="number">0</span>, <span class="number">-3.0f</span>));</span><br><span class="line">    _shader_green.<span class="built_in">setMatrix</span>(<span class="string">&quot;_modelMatrix&quot;</span>, _modelMatrix);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//绘制方盒</span></span><br><span class="line">    <span class="built_in">glBindVertexArray</span>(VAO_cube);</span><br><span class="line">    <span class="built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="number">0</span>, <span class="number">36</span>);</span><br><span class="line">    _shader_green.<span class="built_in">end</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="GeometryShader-几何着色器"><a href="#GeometryShader-几何着色器" class="headerlink" title="GeometryShader 几何着色器"></a>GeometryShader 几何着色器</h2><h3 id="几何着色器原理"><a href="#几何着色器原理" class="headerlink" title="几何着色器原理"></a>几何着色器原理</h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240813112627591.png" alt="image-20240813112627591" style="zoom: 67%;" />

<p>几何着色器对装配的顶点进行生成或减除操作 重新定义图元的类型</p>
<h4 id="点输入"><a href="#点输入" class="headerlink" title="点输入"></a>点输入</h4><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240813113119032.png" alt="image-20240813113119032" style="zoom:67%;" />

<h4 id="三角形输入"><a href="#三角形输入" class="headerlink" title="三角形输入"></a>三角形输入</h4><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240813113216231.png" alt="image-20240813113216231" style="zoom:67%;" />

<p>每三个一组创建一个gl_in将变量放到gl_in中，输送给Geometry Shading</p>
<h4 id="Geometry-输出-重新定义了图元装配的类型"><a href="#Geometry-输出-重新定义了图元装配的类型" class="headerlink" title="Geometry 输出 重新定义了图元装配的类型"></a>Geometry 输出 重新定义了图元装配的类型</h4><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240813114156720.png" alt="image-20240813114156720" style="zoom:67%;" />

<h4 id="GeometryShader"><a href="#GeometryShader" class="headerlink" title="GeometryShader"></a>GeometryShader</h4><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># version 330 core</span></span><br><span class="line"><span class="keyword">layout</span> (point)<span class="keyword">in</span>;</span><br><span class="line"><span class="keyword">layout</span> (<span class="keyword">line_strip</span>, <span class="keyword">max_vertices</span>=<span class="number">2</span>) <span class="keyword">out</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()&#123;</span><br><span class="line">	<span class="built_in">gl_Position</span> ==  <span class="built_in">gl_in</span>[<span class="number">0</span>].<span class="built_in">gl_Position</span> + <span class="type">vec4</span>(<span class="number">-0.1</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>);</span><br><span class="line">	<span class="built_in">EmitVertex</span>();</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">gl_Position</span> = <span class="built_in">gl_in</span>[<span class="number">0</span>].<span class="built_in">gl_Position</span> + <span class="type">vec4</span>(<span class="number">0.1</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>);</span><br><span class="line">	Emitvertex();</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">EndPrimitive</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240813115017884.png" alt="image-20240813115017884" style="zoom:67%;" />

<h4 id="gl-in"><a href="#gl-in" class="headerlink" title="gl_in"></a>gl_in</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">in gl_Vertex</span><br><span class="line">&#123;</span><br><span class="line">	vec4 gl_Position;</span><br><span class="line">	<span class="type">float</span> gl_PointSize;</span><br><span class="line">	<span class="type">float</span> gl_ClipDistance[];	<span class="comment">// 剪裁距离</span></span><br><span class="line">&#125;gl_in[];</span><br></pre></td></tr></table></figure>

<h3 id="法向量可视化"><a href="#法向量可视化" class="headerlink" title="法向量可视化"></a>法向量可视化</h3><ul>
<li>STEP1	正常渲染模型</li>
<li>STEP2	使用geometryShader方式渲染模型，得到法向量</li>
</ul>
<h4 id="VertexShader"><a href="#VertexShader" class="headerlink" title="VertexShader"></a>VertexShader</h4><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#version 330 core</span></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">vec3</span> aPos;</span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">1</span>) <span class="keyword">in</span> <span class="type">vec3</span> aNormal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">out</span> <span class="type">vec3</span> normal;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> view;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> model;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">	gl_position = view * model * <span class="type">vec4</span>(aPos, <span class="number">1.0</span>);</span><br><span class="line">	<span class="type">mat3</span> normalMatrix = <span class="type">mat3</span>(<span class="built_in">transpose</span>(<span class="built_in">inverse</span>(view * model)))；</span><br><span class="line">	normal = normailize(<span class="type">vec3</span>(normalMatrix * aNormal, <span class="number">0.0</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="GeometryShader-1"><a href="#GeometryShader-1" class="headerlink" title="GeometryShader"></a>GeometryShader</h4><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">layout</span>(<span class="keyword">triangles</span>) <span class="keyword">in</span>;</span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">line_strip</span>, <span class="keyword">max_vertices</span> = <span class="number">6</span>) <span class="keyword">out</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">in</span> <span class="type">vec3</span> normal;</span><br><span class="line"><span class="keyword">const</span> <span class="type">float</span> MAGNITUDE = <span class="number">0.4</span>l</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">mat4</span> projection;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> GenerateLine(<span class="type">int</span> <span class="keyword">index</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">gl_Position</span> = projection * <span class="built_in">gl_in</span>[<span class="keyword">index</span>].gl_position;</span><br><span class="line">	<span class="built_in">EmitVertex</span>();</span><br><span class="line">	<span class="built_in">gl_Position</span> = projection * (<span class="built_in">gl_in</span>[<span class="keyword">index</span>].gl_position + <span class="type">vec4</span>(normal, <span class="number">0.0</span>) * MAGNITUDE);</span><br><span class="line">    <span class="built_in">EmitVertex</span>();</span><br><span class="line">    <span class="built_in">EndPrimitive</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="模型读取"><a href="#模型读取" class="headerlink" title="模型读取"></a>模型读取</h2><h3 id="模型材质"><a href="#模型材质" class="headerlink" title="模型材质"></a>模型材质</h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240813151740855.png" alt="image-20240813151740855" style="zoom:67%;" />

<h3 id="Assimp库（读取）"><a href="#Assimp库（读取）" class="headerlink" title="Assimp库（读取）"></a>Assimp库（读取）</h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240813151822375.png" alt="image-20240813151822375" style="zoom:67%;" />

<h4 id="Scene"><a href="#Scene" class="headerlink" title="Scene"></a>Scene</h4><ul>
<li>mRootNode    场景根节点</li>
<li>mMeshs[]	模型顶点信息综合</li>
<li>mMaterials[]   模型贴图信息</li>
</ul>
<h4 id="Child-node"><a href="#Child-node" class="headerlink" title="Child node"></a>Child node</h4><p>部分模型信息</p>
<h3 id="Mesh"><a href="#Mesh" class="headerlink" title="Mesh"></a>Mesh</h3><ul>
<li>模型块，包含构建模型块的所有顶点信息（坐标，法线，UV，索引，纹理等）</li>
<li>模型块数据结构 Vertex Texture Index</li>
<li>函数：构造函数，VBO&#x2F;VAO 设置函数， 绘制函数</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> FF</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	ffBone::<span class="built_in">ffBone</span>(<span class="type">int</span> _id, std::string _name, aiMatrix4x4 _aiMatrix)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//m_mesh = _pMesh;</span></span><br><span class="line">		m_id = _id;</span><br><span class="line">		m_name = _name;</span><br><span class="line">		m_offsetMat = <span class="built_in">AiToGLMMat4</span>(_aiMatrix);</span><br><span class="line"></span><br><span class="line">		m_parent = <span class="literal">NULL</span>;</span><br><span class="line">		m_parentSkeleton = <span class="literal">NULL</span>;</span><br><span class="line">		m_aiAnim = <span class="literal">NULL</span>;</span><br><span class="line">		m_aiNode = <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	ffBone::<span class="built_in">ffBone</span>(<span class="type">int</span> _id, std::string _name, glm::mat4 _matrix)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//m_mesh = _pMesh;</span></span><br><span class="line">		m_id = _id;</span><br><span class="line">		m_name = _name;</span><br><span class="line">		m_offsetMat = _matrix;</span><br><span class="line"></span><br><span class="line">		m_parent = <span class="literal">NULL</span>;</span><br><span class="line">		m_aiAnim = <span class="literal">NULL</span>;</span><br><span class="line">		m_aiNode = <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">glm::mat4 <span class="title">ffBone::getParentsTransform</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		ffBone* _pBone = m_parent;</span><br><span class="line">		std::vector&lt;glm::mat4&gt; _matrixArr;</span><br><span class="line"></span><br><span class="line">		glm::mat4 _tmpMat = glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>);</span><br><span class="line">		<span class="keyword">while</span> (_pBone)</span><br><span class="line">		&#123;</span><br><span class="line">			_tmpMat = <span class="built_in">AiToGLMMat4</span>(_pBone-&gt;m_aiNode-&gt;mTransformation);</span><br><span class="line">			_matrixArr.<span class="built_in">push_back</span>(_tmpMat);</span><br><span class="line">			_pBone = _pBone-&gt;m_parent;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		glm::mat4 _concatenatedTransform = glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>);</span><br><span class="line">		<span class="keyword">for</span> (uint i = _matrixArr.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt; <span class="number">-1</span>; --i)</span><br><span class="line">		&#123;</span><br><span class="line">			_concatenatedTransform *= _matrixArr[i];</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> _concatenatedTransform;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">ffSkeleton::init</span><span class="params">(std::vector&lt;ffBone&gt; _boneArr, glm::mat4 _globalInverseTransform)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		m_globalInverseTransform = _globalInverseTransform;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (uint i = <span class="number">0</span>; i &lt; _boneArr.<span class="built_in">size</span>(); i++)</span><br><span class="line">		&#123;</span><br><span class="line">			m_boneMap[_boneArr[i].m_id] = _boneArr[i];</span><br><span class="line">			_boneArr[i].m_parentSkeleton = <span class="keyword">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*ffBone* ffSkeleton::findBoneByName(std::string _name)</span></span><br><span class="line"><span class="comment">	&#123;</span></span><br><span class="line"><span class="comment">		for (uint i = 0; i &lt; m_boneArr.size(); i++)</span></span><br><span class="line"><span class="comment">		&#123;</span></span><br><span class="line"><span class="comment">			if (m_boneArr[i].m_name == _name)</span></span><br><span class="line"><span class="comment">			&#123;</span></span><br><span class="line"><span class="comment">				return &amp;m_boneArr[i];</span></span><br><span class="line"><span class="comment">			&#125;</span></span><br><span class="line"><span class="comment">		&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">		return NULL;</span></span><br><span class="line"><span class="comment">	&#125;*/</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">ffSkeleton::updateBoneMats</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">ffSkeleton::update</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	ffMesh::<span class="built_in">ffMesh</span>(std::vector&lt;ffVertex&gt; _vertexVec, std::vector&lt;uint&gt; _indexVec, std::vector&lt;ffTexture&gt; _texVec)</span><br><span class="line">	&#123;</span><br><span class="line">		m_vertexVec = _vertexVec;</span><br><span class="line">		m_indexVec = _indexVec;</span><br><span class="line">		m_texVec = _texVec;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">setupMesh</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">ffMesh::draw</span><span class="params">(Shader&amp; _shader)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		uint _diffuseN = <span class="number">1</span>;</span><br><span class="line">		uint _specularN = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (uint i = <span class="number">0</span>; i &lt; m_texVec.<span class="built_in">size</span>(); i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">glActiveTexture</span>(GL_TEXTURE0 + i);</span><br><span class="line"></span><br><span class="line">			<span class="comment">//拼装shader传参字符串</span></span><br><span class="line">			std::string _typeName = m_texVec[i].m_type;</span><br><span class="line">			std::string _numStr;</span><br><span class="line">			<span class="keyword">if</span> (_typeName == TEXTURE_DIFFUSE_STR)</span><br><span class="line">			&#123;</span><br><span class="line">				_numStr = std::<span class="built_in">to_string</span>(_diffuseN++);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (_typeName == TEXTURE_SPECULAR_STR)</span><br><span class="line">			&#123;</span><br><span class="line">				_numStr = std::<span class="built_in">to_string</span>(_specularN++);</span><br><span class="line">			&#125;</span><br><span class="line">			_shader.<span class="built_in">setFloat</span>(<span class="string">&quot;myMaterial.&quot;</span> + _typeName + _numStr, i);</span><br><span class="line">			<span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, m_texVec[i].m_id);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glActiveTexture</span>(GL_TEXTURE0);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glBindVertexArray</span>(m_VAO);</span><br><span class="line">		<span class="built_in">glDrawElements</span>(GL_TRIANGLES, m_indexVec.<span class="built_in">size</span>(), GL_UNSIGNED_INT, <span class="number">0</span>);</span><br><span class="line">		<span class="built_in">glBindVertexArray</span>(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">ffMesh::setupMesh</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		uint _VBO = <span class="number">0</span>;</span><br><span class="line">		uint _EBO = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glGenVertexArrays</span>(<span class="number">1</span>, &amp;m_VAO);</span><br><span class="line">		<span class="built_in">glBindVertexArray</span>(m_VAO);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glGenBuffers</span>(<span class="number">1</span>, &amp;_VBO);</span><br><span class="line">		<span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, _VBO);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(ffVertex) * m_vertexVec.<span class="built_in">size</span>(), &amp;m_vertexVec[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glGenBuffers</span>(<span class="number">1</span>, &amp;_EBO);</span><br><span class="line">		<span class="built_in">glBindBuffer</span>(GL_ELEMENT_ARRAY_BUFFER, _EBO);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glBufferData</span>(GL_ELEMENT_ARRAY_BUFFER, <span class="built_in">sizeof</span>(uint) * m_indexVec.<span class="built_in">size</span>(), &amp;m_indexVec[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glEnableVertexAttribArray</span>(SHADER_POSITION_ANCHOR);</span><br><span class="line">		<span class="built_in">glVertexAttribPointer</span>(SHADER_POSITION_ANCHOR, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="built_in">sizeof</span>(ffVertex), (<span class="type">void</span>*)<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glEnableVertexAttribArray</span>(SHADER_NORMAL_ANCHOR);</span><br><span class="line">		<span class="built_in">glVertexAttribPointer</span>(SHADER_NORMAL_ANCHOR, <span class="number">3</span>, GL_FLOAT, GL_FALSE, <span class="built_in">sizeof</span>(ffVertex), (<span class="type">void</span>*)<span class="built_in">offsetof</span>(ffVertex, m_normal));</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glEnableVertexAttribArray</span>(SHADER_TEXCOORD_ANCHOR);</span><br><span class="line">		<span class="built_in">glVertexAttribPointer</span>(SHADER_TEXCOORD_ANCHOR, <span class="number">2</span>, GL_FLOAT, GL_FALSE, <span class="built_in">sizeof</span>(ffVertex), (<span class="type">void</span>*)<span class="built_in">offsetof</span>(ffVertex, m_texCoord));</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glEnableVertexAttribArray</span>(SHADER_BONE_WEIGHT_ANCHOR);</span><br><span class="line">		<span class="built_in">glVertexAttribPointer</span>(SHADER_BONE_WEIGHT_ANCHOR, <span class="number">4</span>, GL_FLOAT, GL_FALSE, <span class="built_in">sizeof</span>(ffVertex), (<span class="type">void</span>*)<span class="built_in">offsetof</span>(ffVertex, m_weightArr));</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glEnableVertexAttribArray</span>(SHADER_BONE_ID_ANCHOR);</span><br><span class="line">		<span class="built_in">glVertexAttribIPointer</span>(SHADER_BONE_ID_ANCHOR, <span class="number">4</span>, GL_INT, <span class="built_in">sizeof</span>(ffVertex), (<span class="type">void</span>*)<span class="built_in">offsetof</span>(ffVertex, m_idArr));</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glBindVertexArray</span>(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">ffModel::loadModel</span><span class="params">(std::string _path)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Assimp::Importer _importer;</span><br><span class="line">		<span class="type">const</span> aiScene* _scene = _importer.<span class="built_in">ReadFile</span>(_path, aiProcess_Triangulate | aiProcess_FlipUVs);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (!_scene || _scene-&gt;mFlags &amp; AI_SCENE_FLAGS_INCOMPLETE || !_scene-&gt;mRootNode)</span><br><span class="line">		&#123;</span><br><span class="line">			std::cout &lt;&lt; <span class="string">&quot;model read fail!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		m_dir = _path.<span class="built_in">substr</span>(<span class="number">0</span>, _path.<span class="built_in">find_last_of</span>(<span class="string">&#x27;/&#x27;</span>));</span><br><span class="line">		<span class="built_in">processNode</span>(_scene-&gt;mRootNode, _scene);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">ffModel::processNode</span><span class="params">(aiNode* _node, <span class="type">const</span> aiScene* _scene)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (uint i = <span class="number">0</span>; i &lt; _node-&gt;mNumMeshes; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			aiMesh* _mesh = _scene-&gt;mMeshes[_node-&gt;mMeshes[i]];</span><br><span class="line">			m_meshVec.<span class="built_in">push_back</span>(<span class="built_in">processMesh</span>(_mesh, _scene, _node, m_skeleton));</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (uint i = <span class="number">0</span>; i &lt; _node-&gt;mNumChildren; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">processNode</span>(_node-&gt;mChildren[i], _scene);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ffMesh <span class="title">ffModel::processMesh</span><span class="params">(aiMesh* _mesh, <span class="type">const</span> aiScene* _scene, <span class="type">const</span> aiNode* _node)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::vector&lt;ffVertex&gt;	_vertexVec;</span><br><span class="line">		std::vector&lt;uint&gt;		_indexVec;</span><br><span class="line">		std::vector&lt;ffTexture&gt;	_texVec;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (uint i = <span class="number">0</span>; i &lt; _mesh-&gt;mNumVertices; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			ffVertex   _vertex;</span><br><span class="line"></span><br><span class="line">			<span class="comment">//位置信息读取</span></span><br><span class="line">			glm::vec3 _pos;</span><br><span class="line">			_pos.x = _mesh-&gt;mVertices[i].x;</span><br><span class="line">			_pos.y = _mesh-&gt;mVertices[i].y;</span><br><span class="line">			_pos.z = _mesh-&gt;mVertices[i].z;</span><br><span class="line">			_vertex.m_pos = _pos;</span><br><span class="line"></span><br><span class="line">			<span class="comment">//法线</span></span><br><span class="line">			glm::vec3 _normal;</span><br><span class="line">			_normal.x = _mesh-&gt;mNormals[i].x;</span><br><span class="line">			_normal.y = _mesh-&gt;mNormals[i].y;</span><br><span class="line">			_normal.z = _mesh-&gt;mNormals[i].z;</span><br><span class="line">			_vertex.m_normal = _normal;</span><br><span class="line"></span><br><span class="line">			<span class="comment">//纹理坐标</span></span><br><span class="line">			<span class="keyword">if</span> (_mesh-&gt;mTextureCoords[<span class="number">0</span>])</span><br><span class="line">			&#123;</span><br><span class="line">				glm::vec2 _texCoord;</span><br><span class="line">				_texCoord.x = _mesh-&gt;mTextureCoords[<span class="number">0</span>][i].x;</span><br><span class="line">				_texCoord.y = _mesh-&gt;mTextureCoords[<span class="number">0</span>][i].y;</span><br><span class="line">				_vertex.m_texCoord = _texCoord;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			_vertexVec.<span class="built_in">push_back</span>(_vertex);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//解析index</span></span><br><span class="line">		<span class="keyword">for</span> (uint i = <span class="number">0</span>; i &lt; _mesh-&gt;mNumFaces; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			aiFace	_face = _mesh-&gt;mFaces[i];</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span> (uint j = <span class="number">0</span>; j &lt; _face.mNumIndices; j++)</span><br><span class="line">			&#123;</span><br><span class="line">				_indexVec.<span class="built_in">push_back</span>(_face.mIndices[j]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//解析材质</span></span><br><span class="line">		<span class="keyword">if</span> (_mesh-&gt;mMaterialIndex &gt;= <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			aiMaterial* _mat = _scene-&gt;mMaterials[_mesh-&gt;mMaterialIndex];</span><br><span class="line"></span><br><span class="line">			std::vector&lt;ffTexture&gt; _diffuseVec = <span class="built_in">loadMaterialTextures</span>(_mat, aiTextureType_DIFFUSE, TEXTURE_DIFFUSE_STR);</span><br><span class="line">			_texVec.<span class="built_in">insert</span>(_texVec.<span class="built_in">end</span>(), _diffuseVec.<span class="built_in">begin</span>(), _diffuseVec.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">			std::vector&lt;ffTexture&gt; _specularVec = <span class="built_in">loadMaterialTextures</span>(_mat, aiTextureType_SPECULAR, TEXTURE_SPECULAR_STR);</span><br><span class="line">			_texVec.<span class="built_in">insert</span>(_texVec.<span class="built_in">end</span>(), _specularVec.<span class="built_in">begin</span>(), _specularVec.<span class="built_in">end</span>());</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//解析骨骼动画</span></span><br><span class="line">		<span class="keyword">for</span> (uint i = <span class="number">0</span>; i &lt; _mesh-&gt;mNumBones; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			aiBone* _aiBone = _mesh-&gt;mBones[i];</span><br><span class="line"></span><br><span class="line">			<span class="comment">//给顶点权重及骨骼id</span></span><br><span class="line">			<span class="keyword">for</span> (uint j = <span class="number">0</span>; j &lt; _aiBone-&gt;mNumWeights; j++)</span><br><span class="line">			&#123;</span><br><span class="line">				aiVertexWeight	_weight = _aiBone-&gt;mWeights[i];</span><br><span class="line">				<span class="keyword">for</span> (uint k = <span class="number">0</span>; k &lt; MAX_BONE_WEIGHT_PER_VERTEX; k++)</span><br><span class="line">				&#123;</span><br><span class="line">					_vertexVec[_weight.mVertexId].m_weightArr[k] = _weight.mWeight;</span><br><span class="line">					_vertexVec[_weight.mVertexId].m_idArr[k] = i;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">//解析骨骼构建骨骼</span></span><br><span class="line">			<span class="keyword">for</span> (uint i = <span class="number">0</span>; i &lt; _mesh-&gt;mNumBones; i++)</span><br><span class="line">			&#123;</span><br><span class="line">				aiBone* _pBone = _mesh-&gt;mBones[i];</span><br><span class="line">				<span class="keyword">if</span> (!_pBone)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				std::string _boneName = _pBone-&gt;mName.<span class="built_in">C_Str</span>();</span><br><span class="line">				glm::mat4	_boneMatrix = <span class="built_in">AiToGLMMat4</span>(_pBone-&gt;mOffsetMatrix);</span><br><span class="line"></span><br><span class="line">				ffBone _newBone(i, _boneName, _boneMatrix);</span><br><span class="line">				<span class="comment">//_newBone</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">ffMesh</span>(_vertexVec, _indexVec, _texVec);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function">std::vector&lt;ffTexture&gt;	<span class="title">ffModel::loadMaterialTextures</span><span class="params">(aiMaterial* _mat, aiTextureType _type, std::string _typeName)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::vector&lt;ffTexture&gt; _texVec;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (uint i = <span class="number">0</span>; i &lt; _mat-&gt;<span class="built_in">GetTextureCount</span>(_type); i++)</span><br><span class="line">		&#123;</span><br><span class="line">			ffTexture _tex;</span><br><span class="line"></span><br><span class="line">			aiString _path;</span><br><span class="line">			_mat-&gt;<span class="built_in">GetTexture</span>(_type, i, &amp;_path);</span><br><span class="line"></span><br><span class="line">			_tex.m_id = ffTextureMananger::<span class="built_in">getInstance</span>()-&gt;<span class="built_in">createTexture</span>(_path.<span class="built_in">C_Str</span>(), m_dir);</span><br><span class="line">			_tex.m_path = _path.<span class="built_in">C_Str</span>();</span><br><span class="line">			_tex.m_type = _typeName;</span><br><span class="line"></span><br><span class="line">			_texVec.<span class="built_in">push_back</span>(_tex);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> _texVec;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">ffModel::draw</span><span class="params">(Shader&amp; _shader)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (uint i = <span class="number">0</span>; i &lt; m_meshVec.<span class="built_in">size</span>(); i++)</span><br><span class="line">		&#123;</span><br><span class="line">			m_meshVec[i].<span class="built_in">draw</span>(_shader);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">SINGLE_INSTANCE_SET</span>(ffTextureMananger)</span><br><span class="line"></span><br><span class="line">		<span class="function">uint <span class="title">ffTextureMananger::createTexture</span><span class="params">(std::string _path)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::map&lt;std::string, uint&gt;::iterator _it = m_texMap.<span class="built_in">find</span>(_path);</span><br><span class="line">		<span class="keyword">if</span> (_it != m_texMap.<span class="built_in">end</span>())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> _it-&gt;second;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		ffImage* _image = ffImage::<span class="built_in">readFromFile</span>(_path.<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">		uint _texID = <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">glGenTextures</span>(<span class="number">1</span>, &amp;_texID);</span><br><span class="line">		<span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, _texID);</span><br><span class="line"></span><br><span class="line">		<span class="built_in">glTexImage2D</span>(GL_TEXTURE_2D, <span class="number">0</span>, GL_RGBA, _image-&gt;<span class="built_in">getWidth</span>(), _image-&gt;<span class="built_in">getHeight</span>(), <span class="number">0</span>, GL_RGBA, GL_UNSIGNED_BYTE, _image-&gt;<span class="built_in">getData</span>());</span><br><span class="line">		<span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT);</span><br><span class="line">		<span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT);</span><br><span class="line">		<span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST);</span><br><span class="line">		<span class="built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">delete</span> _image;</span><br><span class="line">		m_texMap[_path] = _texID;</span><br><span class="line">		<span class="keyword">return</span> _texID;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">uint <span class="title">ffTextureMananger::createTexture</span><span class="params">(std::string _path, std::string _dir)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">createTexture</span>(_dir + <span class="string">&#x27;/&#x27;</span> + _path);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="DrawCall-减少性能开销"><a href="#DrawCall-减少性能开销" class="headerlink" title="DrawCall 减少性能开销"></a>DrawCall 减少性能开销</h3><p>使用Instance来做 统一将所有渲染任务压入</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">glDrawArraysInstanced</span><span class="params">(GLenum mode, Glint first, GLsizei count, GLsizei primcount)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">glDrawElementsInstanced</span><span class="params">(GLenum mode, GLsizei count, GLenum type, <span class="type">const</span> <span class="type">void</span> * indices, FLsizei primcount)</span></span>; <span class="comment">// primCount 一次性打包绘制的实例数量</span></span><br></pre></td></tr></table></figure>

<h4 id="gl-InstanceID-内置变量"><a href="#gl-InstanceID-内置变量" class="headerlink" title="gl_InstanceID 内置变量"></a>gl_InstanceID 内置变量</h4><p>代表正在绘制的实例编号 从0开始依次递增</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#version 330 core</span></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">vec2</span> aPos;</span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">1</span>) <span class="keyword">in</span> <span class="type">vec3</span> aColor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">out</span> <span class="type">vec3</span> fColor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">uniform</span> <span class="type">vec2</span> offsets[<span class="number">100</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">vec2</span> <span class="keyword">offset</span> = <span class="keyword">offset</span>[<span class="built_in">gl_InstanceID</span>];</span><br><span class="line">	<span class="built_in">gl_Position</span> = <span class="type">vec4</span>(aPos + <span class="keyword">offset</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">	fColor = aColor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用gl_InstanceID 会导致过多的使用uniform变量</p>
<h4 id="gl-InstanceID-内置变量-优化-InstanceArray"><a href="#gl-InstanceID-内置变量-优化-InstanceArray" class="headerlink" title="gl_InstanceID 内置变量 优化 InstanceArray"></a>gl_InstanceID 内置变量 优化 InstanceArray</h4><p>利用顶点数组VBO进行书传书 VShader中使用layout进行MAT4的获取</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">glGenBuffers(<span class="number">1</span>, &amp;_VBO_ins);</span><br><span class="line">glBindBuffer(GL_ARRAY_BUFFER, VBO_ins);</span><br><span class="line">glBufferData(GL_ARRAY_BUFFER, sizeof(glm::<span class="type">mat4</span>) * AMOUNT, _mMatrixArrp[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line"><span class="comment">// 挂载锚点绑定数据， AttriPointer最多支持vec4，所以拆开</span></span><br><span class="line">glBIndVertexArray(_model-&gt;m_meshVec[i].m_VAO);</span><br><span class="line">glEnableVertexAttribArray(<span class="number">3</span>);</span><br><span class="line">glVertexAttribPointer(<span class="number">3</span>,<span class="number">4</span>,GL_FLOAT,GL_FALSE,sizeof(glm::<span class="type">mat4</span>),(<span class="type">void</span>*)<span class="number">0</span>);</span><br><span class="line">glEnableVertexAttribArray(<span class="number">4</span>);</span><br><span class="line">glVertexAttribPointer(<span class="number">4</span>,<span class="number">4</span>,GL_FLOAT,GL_FALSE,sizeof(glm::<span class="type">mat4</span>),(<span class="type">void</span>*)<span class="number">0</span>(sizeof(glm::<span class="type">vec4</span>));</span><br><span class="line">glEnableVertexAttribArray(<span class="number">5</span>);</span><br><span class="line">glVertexAttribPointer(<span class="number">5</span>,<span class="number">4</span>,GL_FLOAT,GL_FALSE,sizeof(glm::<span class="type">mat4</span>),(<span class="type">void</span>*)<span class="number">0</span>(sizeof(glm::<span class="type">vec4</span>)*<span class="number">2</span>);</span><br><span class="line">glEnableVertexAttribArray(<span class="number">6</span>);</span><br><span class="line">glVertexAttribPointer(<span class="number">6</span>,<span class="number">4</span>,GL_FLOAT,GL_FALSE,sizeof(glm::<span class="type">mat4</span>),(<span class="type">void</span>*)<span class="number">0</span>(sizeof(glm::<span class="type">vec4</span>)*<span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<h4 id="glVertexAttribDivisor-GLuint-index-GLuint-divisor"><a href="#glVertexAttribDivisor-GLuint-index-GLuint-divisor" class="headerlink" title="glVertexAttribDivisor(GLuint index, GLuint divisor)"></a>glVertexAttribDivisor(GLuint index, GLuint divisor)</h4><p>index：挂载的锚点</p>
<p>divisor：多少个实例迭代一次， 0 代表一个顶点迭代一次， 1代表一个模型实例绘制迭代一次</p>
<h3 id="Instance-实现"><a href="#Instance-实现" class="headerlink" title="Instance 实现"></a>Instance 实现</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> AMOUNT 100000</span></span><br><span class="line"></span><br><span class="line">glm::mat4* _mMatrixArr = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">FF::ffModel* _model = <span class="literal">NULL</span>;</span><br><span class="line">uint _VBO_ins;</span><br><span class="line">uint _texId;</span><br><span class="line"></span><br><span class="line">Shader          _shader;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Camera          _camera;</span><br><span class="line"></span><br><span class="line">glm::mat4 _projMatrix(<span class="number">1.0f</span>);</span><br><span class="line"><span class="type">int</span>       _width = <span class="number">800</span>;</span><br><span class="line"><span class="type">int</span>       _height = <span class="number">600</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rend</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">glClearColor</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>);</span><br><span class="line">    <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glEnable</span>(GL_DEPTH_TEST);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    _camera.<span class="built_in">update</span>();</span><br><span class="line">    _projMatrix = glm::<span class="built_in">perspective</span>(glm::<span class="built_in">radians</span>(<span class="number">45.0f</span>), (<span class="type">float</span>)_width / (<span class="type">float</span>)_height, <span class="number">0.1f</span>, <span class="number">100.0f</span>);</span><br><span class="line"></span><br><span class="line">    _shader.<span class="built_in">start</span>();</span><br><span class="line">    _shader.<span class="built_in">setMatrix</span>(<span class="string">&quot;_viewMatrix&quot;</span>, _camera.<span class="built_in">getMatrix</span>());</span><br><span class="line">    _shader.<span class="built_in">setMatrix</span>(<span class="string">&quot;_projMatrix&quot;</span>, _projMatrix);</span><br><span class="line">    _shader.<span class="built_in">setFloat</span>(<span class="string">&quot;myMaterial.m_shiness&quot;</span>, <span class="number">32.0f</span>);</span><br><span class="line">    _shader.<span class="built_in">setVec3</span>(<span class="string">&quot;view_pos&quot;</span>, _camera.<span class="built_in">getPosition</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//光照设置</span></span><br><span class="line">    _shader.<span class="built_in">setVec3</span>(<span class="string">&quot;myLight.m_pos&quot;</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">    _shader.<span class="built_in">setVec3</span>(<span class="string">&quot;myLight.m_ambient&quot;</span>, glm::<span class="built_in">vec3</span>(<span class="number">0.9f</span>, <span class="number">0.9f</span>, <span class="number">0.9f</span>));</span><br><span class="line">    _shader.<span class="built_in">setVec3</span>(<span class="string">&quot;myLight.m_diffuse&quot;</span>, glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line">    _shader.<span class="built_in">setVec3</span>(<span class="string">&quot;myLight.m_specular&quot;</span>, glm::<span class="built_in">vec3</span>(<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line"></span><br><span class="line">    _shader.<span class="built_in">setFloat</span>(<span class="string">&quot;myLight.c&quot;</span>, <span class="number">1.0f</span>);</span><br><span class="line">    _shader.<span class="built_in">setFloat</span>(<span class="string">&quot;myLight.l&quot;</span>, <span class="number">0.09f</span>);</span><br><span class="line">    _shader.<span class="built_in">setFloat</span>(<span class="string">&quot;myLight.q&quot;</span>, <span class="number">0.032f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glBindTexture</span>(GL_TEXTURE_2D, _texId);</span><br><span class="line">    <span class="keyword">for</span> (uint i = <span class="number">0</span>; i &lt; _model-&gt;m_meshVec.<span class="built_in">size</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">glBindVertexArray</span>(_model-&gt;m_meshVec[i].m_VAO);</span><br><span class="line">        <span class="built_in">glDrawElementsInstanced</span>(GL_TRIANGLES, _model-&gt;m_meshVec[i].m_vertexVec.<span class="built_in">size</span>(), GL_UNSIGNED_INT, <span class="number">0</span>, AMOUNT);</span><br><span class="line">        <span class="built_in">glBindVertexArray</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* for (uint i = 0; i &lt; AMOUNT; i++)</span></span><br><span class="line"><span class="comment">     &#123;</span></span><br><span class="line"><span class="comment">         _shader.setMatrix(&quot;_modelMatrix&quot;, _mMatrixArr[i]);</span></span><br><span class="line"><span class="comment">         _model-&gt;draw(_shader);</span></span><br><span class="line"><span class="comment">     &#125;*/</span></span><br><span class="line"></span><br><span class="line">    _shader.<span class="built_in">end</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initShader</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    _shader.<span class="built_in">initShader</span>(<span class="string">&quot;shader/vPointShader.glsl&quot;</span>, <span class="string">&quot;shader/fPointShader.glsl&quot;</span>);</span><br><span class="line">    <span class="comment">//_shader.initShader(&quot;shader/vertexShader.glsl&quot;, &quot;shader/fragmentShader.glsl&quot;);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">framebuffer_size_callback</span><span class="params">(GLFWwindow* window, <span class="type">int</span> width, <span class="type">int</span> height)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">processInput</span><span class="params">(GLFWwindow* window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">glfwGetKey</span>(window, GLFW_KEY_ESCAPE) == GLFW_PRESS)</span><br><span class="line">        <span class="built_in">glfwSetWindowShouldClose</span>(window, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">glfwGetKey</span>(window, GLFW_KEY_W) == GLFW_PRESS)</span><br><span class="line">    &#123;</span><br><span class="line">        _camera.<span class="built_in">move</span>(CAMERA_MOVE::MOVE_FRONT);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">glfwGetKey</span>(window, GLFW_KEY_S) == GLFW_PRESS)</span><br><span class="line">    &#123;</span><br><span class="line">        _camera.<span class="built_in">move</span>(CAMERA_MOVE::MOVE_BACK);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">glfwGetKey</span>(window, GLFW_KEY_A) == GLFW_PRESS)</span><br><span class="line">    &#123;</span><br><span class="line">        _camera.<span class="built_in">move</span>(CAMERA_MOVE::MOVE_LEFT);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">glfwGetKey</span>(window, GLFW_KEY_D) == GLFW_PRESS)</span><br><span class="line">    &#123;</span><br><span class="line">        _camera.<span class="built_in">move</span>(CAMERA_MOVE::MOVE_RIGHT);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">mouse_callback</span><span class="params">(GLFWwindow* window, <span class="type">double</span> xpos, <span class="type">double</span> ypos)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    _camera.<span class="built_in">onMouseMove</span>(xpos, ypos);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initInstanceArray</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//准备模型变换矩阵</span></span><br><span class="line">    _mMatrixArr = <span class="keyword">new</span> glm::mat4[AMOUNT];</span><br><span class="line">    <span class="built_in">srand</span>(<span class="built_in">glfwGetTime</span>());</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> radius = <span class="number">10.0</span>;</span><br><span class="line">    <span class="type">float</span> offset = <span class="number">2.5f</span>;</span><br><span class="line"></span><br><span class="line">    glm::mat4 model = glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> <span class="type">int</span> i = <span class="number">0</span>; i &lt; AMOUNT; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        glm::mat4 model = glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">float</span> angle = (<span class="type">float</span>)i / (<span class="type">float</span>)AMOUNT * <span class="number">360.0f</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">float</span> displacement = (<span class="built_in">rand</span>() % (<span class="type">int</span>)(<span class="number">2</span> * offset * <span class="number">100</span>)) / <span class="number">100.0f</span> - offset;</span><br><span class="line">        <span class="type">float</span> x = <span class="built_in">sin</span>(angle) * radius + displacement;</span><br><span class="line">        displacement = (<span class="built_in">rand</span>() % (<span class="type">int</span>)(<span class="number">2</span> * offset * <span class="number">100</span>)) / <span class="number">100.0f</span> - offset;</span><br><span class="line">        <span class="type">float</span> y = displacement * <span class="number">0.4f</span>;</span><br><span class="line">        displacement = (<span class="built_in">rand</span>() % (<span class="type">int</span>)(<span class="number">2</span> * offset * <span class="number">100</span>)) / <span class="number">100.0f</span> - offset;</span><br><span class="line">        <span class="type">float</span> z = <span class="built_in">cos</span>(angle) * radius + displacement;</span><br><span class="line"></span><br><span class="line">        model = glm::<span class="built_in">translate</span>(model, glm::<span class="built_in">vec3</span>(x, y, z));</span><br><span class="line"></span><br><span class="line">        <span class="type">float</span> scale = (<span class="built_in">rand</span>() % <span class="number">20</span>) / <span class="number">100.0f</span> + <span class="number">0.05</span>;</span><br><span class="line">        model = glm::<span class="built_in">scale</span>(model, glm::<span class="built_in">vec3</span>(scale));</span><br><span class="line"></span><br><span class="line">        <span class="type">float</span> rotAngle = (<span class="built_in">rand</span>() % <span class="number">360</span>);</span><br><span class="line">        model = glm::<span class="built_in">rotate</span>(model, glm::<span class="built_in">radians</span>(rotAngle), glm::<span class="built_in">vec3</span>(<span class="number">0.4f</span>, <span class="number">0.6f</span>, <span class="number">0.8f</span>));</span><br><span class="line"></span><br><span class="line">        _mMatrixArr[i] = model;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">glGenBuffers</span>(<span class="number">1</span>, &amp;_VBO_ins);</span><br><span class="line">    <span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, _VBO_ins);</span><br><span class="line">    <span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in">sizeof</span>(glm::mat4) * AMOUNT, &amp;_mMatrixArr[<span class="number">0</span>], GL_STATIC_DRAW);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (uint i = <span class="number">0</span>; i &lt; _model-&gt;m_meshVec.<span class="built_in">size</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">glBindVertexArray</span>(_model-&gt;m_meshVec[i].m_VAO);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">3</span>);</span><br><span class="line">        <span class="built_in">glVertexAttribPointer</span>(<span class="number">3</span>, <span class="number">4</span>, GL_FLOAT, GL_FALSE, <span class="built_in">sizeof</span>(glm::mat4), (<span class="type">void</span>*)<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">4</span>);</span><br><span class="line">        <span class="built_in">glVertexAttribPointer</span>(<span class="number">4</span>, <span class="number">4</span>, GL_FLOAT, GL_FALSE, <span class="built_in">sizeof</span>(glm::mat4), (<span class="type">void</span>*)(<span class="built_in">sizeof</span>(glm::vec4)));</span><br><span class="line"></span><br><span class="line">        <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">5</span>);</span><br><span class="line">        <span class="built_in">glVertexAttribPointer</span>(<span class="number">5</span>, <span class="number">4</span>, GL_FLOAT, GL_FALSE, <span class="built_in">sizeof</span>(glm::mat4), (<span class="type">void</span>*)(<span class="built_in">sizeof</span>(glm::vec4) * <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">        <span class="built_in">glEnableVertexAttribArray</span>(<span class="number">6</span>);</span><br><span class="line">        <span class="built_in">glVertexAttribPointer</span>(<span class="number">6</span>, <span class="number">4</span>, GL_FLOAT, GL_FALSE, <span class="built_in">sizeof</span>(glm::mat4), (<span class="type">void</span>*)(<span class="built_in">sizeof</span>(glm::vec4) * <span class="number">3</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="built_in">glVertexAttribDivisor</span>(<span class="number">3</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">glVertexAttribDivisor</span>(<span class="number">4</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">glVertexAttribDivisor</span>(<span class="number">5</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">glVertexAttribDivisor</span>(<span class="number">6</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">glBindVertexArray</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    _texId = FF::ffTextureManager::<span class="built_in">getInstance</span>()-&gt;<span class="built_in">createTexture</span>(<span class="string">&quot;res/rock/rock.png&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">glfwInit</span>();</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="number">3</span>);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="number">3</span>);</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_OPENGL_PROFILE, GLFW_OPENGL_COMPAT_PROFILE);</span><br><span class="line"></span><br><span class="line">    GLFWwindow* window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;OpenGL Core&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (window == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Failed to create GLFW window&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="built_in">glfwTerminate</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">glfwMakeContextCurrent</span>(window);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">gladLoadGLLoader</span>((GLADloadproc)glfwGetProcAddress))</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Failed to initialize GLAD&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glViewport</span>(<span class="number">0</span>, <span class="number">0</span>, _width, _height);</span><br><span class="line">    <span class="built_in">glfwSetFramebufferSizeCallback</span>(window, framebuffer_size_callback);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwSetInputMode</span>(window, GLFW_CURSOR, GLFW_CURSOR_DISABLED);</span><br><span class="line">    <span class="built_in">glfwSetCursorPosCallback</span>(window, mouse_callback);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    _camera.<span class="built_in">lookAt</span>(glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">8.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-1.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">    _camera.<span class="built_in">setSpeed</span>(<span class="number">0.01f</span>);</span><br><span class="line"></span><br><span class="line">    _model = <span class="keyword">new</span> FF::<span class="built_in">ffModel</span>(<span class="string">&quot;res/rock/rock.obj&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">initInstanceArray</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">initShader</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">processInput</span>(window);</span><br><span class="line">        <span class="built_in">rend</span>();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">glfwSwapBuffers</span>(window);</span><br><span class="line">        <span class="built_in">glfwPollEvents</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">glfwTerminate</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Blin-Phong-光照实现"><a href="#Blin-Phong-光照实现" class="headerlink" title="Blin-Phong 光照实现"></a>Blin-Phong 光照实现</h2><h3 id="半程向量"><a href="#半程向量" class="headerlink" title="半程向量"></a>半程向量</h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240815185752239.png" alt="image-20240815185752239" style="zoom:67%;" />

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_image/image-20240815190032563.png" alt="image-20240815190032563" style="zoom:67%;" />

<p>反射光和人眼的夹角大于九十度 导致光线被计算忽略 造成偏差</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_imageavater.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_imageavater.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">Edmend Zhang</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2024/08/16/graphics/opengl/OpenGL%20Advance/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2024/08/16/graphics/opengl/OpenGL%20Advance/')">OpenGL Advance</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2024/08/16/graphics/opengl/OpenGL%20Advance/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=OpenGL Advance&amp;url=http://example.com/2024/08/16/graphics/opengl/OpenGL%20Advance/&amp;pic=https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/cover_top_image/Photo%20by%20Aleks%20Marinkovic%20%28jUKpxAfSHlE%29.jpg?_r_=5d68dee6-315f-3b77-cf4f-d639fe02c204" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Graphics/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Graphics<span class="tagsPageCount">14</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/cover_top_image/Photo%20by%20Aleks%20Marinkovic%20%28jUKpxAfSHlE%29.jpg?_r_=064e61fd-7215-d0bd-f956-6e5185608a6b" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/08/12/Tools/VCPKG%20%E4%BD%BF%E7%94%A8/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/cover_top_image/Photo%20by%20Aleks%20Marinkovic%20%28jUKpxAfSHlE%29.jpg?_r_=1625471f-1fb4-d6b7-4b8b-4c4c00bc9cff" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">VCPKG 使用</div></div></a></div><div class="next-post pull-right"><a href="/2024/08/16/graphics/opengl/OPENGL%20+%20FFMPEG%20%E5%AE%9E%E7%8E%B0%E5%85%A8%E6%99%AF%E6%92%AD%E6%94%BE%E5%99%A8/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/cover_top_image/Photo%20by%20Abyan%20Athif%20%28DvYwy0mQdE0%29.jpg?_r_=df9dd8dc-8390-1381-048f-0df0b5876403" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">OPENGL + FFMPEG 实现全景播放器</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2024/07/30/graphics/Games101/Games%20101%20Geometry/" title="Geometry"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/cover_top_image/Photo%20by%20Alberto%20Restifo%20%28Ni4NgA64TFQ%29.jpg?_r_=74e1bb2b-fe46-3db7-f291-d5c3eab521ad" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-07-30</div><div class="title">Geometry</div></div></a></div><div><a href="/2024/07/29/graphics/Games101/Games%20101%20Homework/" title="Homework"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/cover_top_image/Photo%20by%20Aleks%20Marinkovic%20%28jUKpxAfSHlE%29.jpg?_r_=215f4bc7-66ee-14b5-f11f-55bce272d309" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-07-29</div><div class="title">Homework</div></div></a></div><div><a href="/2024/07/28/graphics/Games101/Games%20101%20Illumination%EF%BC%8CShading%20and%20Graphics%20Pipeline/" title="Illumination，Shading and Graphics Pipeline"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/cover_top_image/Photo%20by%20Ales%20Krivec%20%28n4rF9mEEzNg%29.jpg?_r_=d067db27-2f84-e912-40f8-e1b6f1c67c4d" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-07-28</div><div class="title">Illumination，Shading and Graphics Pipeline</div></div></a></div><div><a href="/2024/07/27/graphics/Games101/Games%20101%20Materials%20and%20Appearances/" title="Materials and Appearances"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/cover_top_image/Photo%20by%20Aldebaran%20S%20%28nRAOQdF4IM4%29.jpg?_r_=d6c0c200-f20f-6dbd-1434-3f5c07d7d3df" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-07-27</div><div class="title">Materials and Appearances</div></div></a></div><div><a href="/2024/07/26/graphics/Games101/Games%20101%20Rasterization/" title="Rasterization"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/cover_top_image/Photo%20by%20Alberto%20Restifo%20%28Ni4NgA64TFQ%29.jpg?_r_=bee2e730-b0e2-467d-54ee-26133371e771" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-07-26</div><div class="title">Rasterization</div></div></a></div><div><a href="/2024/07/25/graphics/Games101/Games%20101%20Ray%20Tracing%EF%BC%881%EF%BC%89/" title="Ray Tracing（1）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/cover_top_image/Photo%20by%20Alessandro%20Erbetta%20%28mpWPcRT9D1E%29.jpg?_r_=b8f640ee-7fc1-a5d5-3869-91c64c8871d3" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-07-25</div><div class="title">Ray Tracing（1）</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> Comment</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/blog_imageavater.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>Announcement</span></div><div class="announcement_content">欢迎~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#OpenGL-Advance"><span class="toc-number">1.</span> <span class="toc-text">OpenGL Advance</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%B1%E5%BA%A6%E6%B5%8B%E8%AF%95"><span class="toc-number">1.1.</span> <span class="toc-text">深度测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B1%E5%BA%A6%E5%80%BC%E6%8E%A8%E5%AF%BC"><span class="toc-number">1.1.1.</span> <span class="toc-text">深度值推导</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E7%BC%93%E5%AD%98"><span class="toc-number">1.1.2.</span> <span class="toc-text">模板缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E5%85%89%E8%BE%B9%E7%BC%98%EF%BC%88%E9%80%89%E4%B8%AD%E6%95%88%E6%9E%9C%EF%BC%89%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.3.</span> <span class="toc-text">高光边缘（选中效果）原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Blending-%E6%95%88%E6%9E%9C"><span class="toc-number">1.2.</span> <span class="toc-text">Blending 效果</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%8F%E6%98%8E%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-number">1.2.1.</span> <span class="toc-text">透明的原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.2.2.</span> <span class="toc-text">接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cullFace%E8%A1%A8%E9%9D%A2%E5%89%94%E9%99%A4"><span class="toc-number">1.3.</span> <span class="toc-text">cullFace表面剔除</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E9%9D%A2%E7%9A%84%E9%A1%B6%E7%82%B9%E7%BB%98%E5%88%B6%E9%A1%BA%E5%BA%8F"><span class="toc-number">1.3.1.</span> <span class="toc-text">定义面的顶点绘制顺序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3-1"><span class="toc-number">1.3.2.</span> <span class="toc-text">接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FramBuffer-%E5%B8%A7%E7%BC%93%E5%AD%98"><span class="toc-number">1.4.</span> <span class="toc-text">FramBuffer 帧缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%B8%A7%E7%BC%93%E5%AD%98"><span class="toc-number">1.4.1.</span> <span class="toc-text">创建帧缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Texture-%E4%BD%9C%E4%B8%BABuffer%E9%99%84%E4%BB%B6ColorBuffer"><span class="toc-number">1.4.2.</span> <span class="toc-text">Texture 作为Buffer附件ColorBuffer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RenderBuffer%E4%BD%9C%E4%B8%BABuffer%E9%99%84%E4%BB%B6ColorBuffer"><span class="toc-number">1.4.3.</span> <span class="toc-text">RenderBuffer作为Buffer附件ColorBuffer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FrameBuffer-%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B"><span class="toc-number">1.4.4.</span> <span class="toc-text">FrameBuffer 渲染流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CubeMap"><span class="toc-number">1.5.</span> <span class="toc-text">CubeMap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3-2"><span class="toc-number">1.5.1.</span> <span class="toc-text">接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A9%E7%A9%BA%E7%9B%92%E7%90%86%E8%AE%BA"><span class="toc-number">1.5.2.</span> <span class="toc-text">天空盒理论</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A9%E7%A9%BA%E7%9B%92Shader%E8%A7%A3%E6%9E%90"><span class="toc-number">1.5.3.</span> <span class="toc-text">天空盒Shader解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A9%E7%A9%BA%E7%9B%92%E4%BC%98%E5%8C%96"><span class="toc-number">1.5.4.</span> <span class="toc-text">天空盒优化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E8%B4%B4%E5%9B%BE"><span class="toc-number">1.6.</span> <span class="toc-text">环境贴图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84"><span class="toc-number">1.6.1.</span> <span class="toc-text">反射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Shader"><span class="toc-number">1.6.2.</span> <span class="toc-text">Shader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%98%E5%B0%84"><span class="toc-number">1.6.3.</span> <span class="toc-text">折射</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.7.</span> <span class="toc-text">数据接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E7%82%B9%E6%95%B0%E6%8D%AE%E6%8B%B7%E8%B4%9D"><span class="toc-number">1.7.1.</span> <span class="toc-text">定点数据拷贝</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#glMapBuffer-%E8%99%9A%E6%8B%9F%E6%8C%87%E9%92%88"><span class="toc-number">1.7.2.</span> <span class="toc-text">glMapBuffer 虚拟指针</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B6%E7%82%B9%E6%95%B0%E6%8D%AE%E6%89%93%E5%8C%85%E6%96%B9%E5%BC%8F"><span class="toc-number">1.7.3.</span> <span class="toc-text">顶点数据打包方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#buffer%E4%B9%8B%E9%97%B4%E7%9A%84%E6%95%B0%E6%8D%AE%E6%8B%B7%E8%B4%9D"><span class="toc-number">1.7.4.</span> <span class="toc-text">buffer之间的数据拷贝</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F"><span class="toc-number">1.7.5.</span> <span class="toc-text">内置变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E6%95%B0%E6%8D%AE%E5%9D%97-Blocks"><span class="toc-number">1.7.6.</span> <span class="toc-text">接口数据块 Blocks</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UniformBlock-%E6%98%BE%E5%AD%98%E5%88%86%E9%85%8D"><span class="toc-number">1.8.</span> <span class="toc-text">UniformBlock 显存分配</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E6%95%B0%E6%8D%AE%E5%9D%97-Uniform-Buffer-Object"><span class="toc-number">1.8.1.</span> <span class="toc-text">全局数据块 Uniform Buffer Object</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shared-%E9%BB%98%E8%AE%A4%E6%96%B9%E5%BC%8F"><span class="toc-number">1.8.2.</span> <span class="toc-text">**shared 默认方式 **</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#std140"><span class="toc-number">1.8.3.</span> <span class="toc-text">std140</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UBO-%E7%94%9F%E6%88%90%E8%BF%87%E7%A8%8B"><span class="toc-number">1.8.4.</span> <span class="toc-text">UBO 生成过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#core-code-%E7%9C%81%E7%95%A5%E5%90%8E"><span class="toc-number">1.8.5.</span> <span class="toc-text">core code 省略后</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GeometryShader-%E5%87%A0%E4%BD%95%E7%9D%80%E8%89%B2%E5%99%A8"><span class="toc-number">1.9.</span> <span class="toc-text">GeometryShader 几何着色器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%A0%E4%BD%95%E7%9D%80%E8%89%B2%E5%99%A8%E5%8E%9F%E7%90%86"><span class="toc-number">1.9.1.</span> <span class="toc-text">几何着色器原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%82%B9%E8%BE%93%E5%85%A5"><span class="toc-number">1.9.1.1.</span> <span class="toc-text">点输入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E8%A7%92%E5%BD%A2%E8%BE%93%E5%85%A5"><span class="toc-number">1.9.1.2.</span> <span class="toc-text">三角形输入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Geometry-%E8%BE%93%E5%87%BA-%E9%87%8D%E6%96%B0%E5%AE%9A%E4%B9%89%E4%BA%86%E5%9B%BE%E5%85%83%E8%A3%85%E9%85%8D%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.9.1.3.</span> <span class="toc-text">Geometry 输出 重新定义了图元装配的类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GeometryShader"><span class="toc-number">1.9.1.4.</span> <span class="toc-text">GeometryShader</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gl-in"><span class="toc-number">1.9.1.5.</span> <span class="toc-text">gl_in</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%95%E5%90%91%E9%87%8F%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-number">1.9.2.</span> <span class="toc-text">法向量可视化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#VertexShader"><span class="toc-number">1.9.2.1.</span> <span class="toc-text">VertexShader</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GeometryShader-1"><span class="toc-number">1.9.2.2.</span> <span class="toc-text">GeometryShader</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E8%AF%BB%E5%8F%96"><span class="toc-number">1.10.</span> <span class="toc-text">模型读取</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E6%9D%90%E8%B4%A8"><span class="toc-number">1.10.1.</span> <span class="toc-text">模型材质</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Assimp%E5%BA%93%EF%BC%88%E8%AF%BB%E5%8F%96%EF%BC%89"><span class="toc-number">1.10.2.</span> <span class="toc-text">Assimp库（读取）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Scene"><span class="toc-number">1.10.2.1.</span> <span class="toc-text">Scene</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Child-node"><span class="toc-number">1.10.2.2.</span> <span class="toc-text">Child node</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mesh"><span class="toc-number">1.10.3.</span> <span class="toc-text">Mesh</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DrawCall-%E5%87%8F%E5%B0%91%E6%80%A7%E8%83%BD%E5%BC%80%E9%94%80"><span class="toc-number">1.10.4.</span> <span class="toc-text">DrawCall 减少性能开销</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#gl-InstanceID-%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F"><span class="toc-number">1.10.4.1.</span> <span class="toc-text">gl_InstanceID 内置变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gl-InstanceID-%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F-%E4%BC%98%E5%8C%96-InstanceArray"><span class="toc-number">1.10.4.2.</span> <span class="toc-text">gl_InstanceID 内置变量 优化 InstanceArray</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#glVertexAttribDivisor-GLuint-index-GLuint-divisor"><span class="toc-number">1.10.4.3.</span> <span class="toc-text">glVertexAttribDivisor(GLuint index, GLuint divisor)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Instance-%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.10.5.</span> <span class="toc-text">Instance 实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Blin-Phong-%E5%85%89%E7%85%A7%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.11.</span> <span class="toc-text">Blin-Phong 光照实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8A%E7%A8%8B%E5%90%91%E9%87%8F"><span class="toc-number">1.11.1.</span> <span class="toc-text">半程向量</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/08/16/intern/%E5%85%B3%E4%BA%8E%E8%99%9A%E6%8B%9F%E6%9C%BA%20virtualBox%20VMware%20%E5%92%8C%20wsl/" title="关于虚拟机 virtualBox VMware 和 wsl"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/cover_top_image/Photo%20by%20Aleks%20Marinkovic%20%28jUKpxAfSHlE%29.jpg?_r_=064e61fd-7215-d0bd-f956-6e5185608a6b" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="关于虚拟机 virtualBox VMware 和 wsl"/></a><div class="content"><a class="title" href="/2024/08/16/intern/%E5%85%B3%E4%BA%8E%E8%99%9A%E6%8B%9F%E6%9C%BA%20virtualBox%20VMware%20%E5%92%8C%20wsl/" title="关于虚拟机 virtualBox VMware 和 wsl">关于虚拟机 virtualBox VMware 和 wsl</a><time datetime="2024-08-16T02:54:34.752Z" title="Created 2024-08-16 02:54:34">2024-08-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/16/Unreal/Unreal%20Shoot%20Game/" title="No title"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/cover_top_image/Photo%20by%20Aaron%20Burden%20%28MSRRAkkLi9U%29.jpg?_r_=32f47d99-3661-05c4-2245-c287c615778c" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="No title"/></a><div class="content"><a class="title" href="/2024/08/16/Unreal/Unreal%20Shoot%20Game/" title="No title">No title</a><time datetime="2024-08-16T02:54:34.748Z" title="Created 2024-08-16 02:54:34">2024-08-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/16/Unreal/Unreal-GamePlay-%E6%A1%86%E6%9E%B6/" title="Unreal GamePlay 框架"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/cover_top_image/Photo%20by%20Alessio%20Soggetti%20%281mkVnXqAErM%29.jpg?_r_=2bde2089-b6c0-e489-de7a-beb221437ad0" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Unreal GamePlay 框架"/></a><div class="content"><a class="title" href="/2024/08/16/Unreal/Unreal-GamePlay-%E6%A1%86%E6%9E%B6/" title="Unreal GamePlay 框架">Unreal GamePlay 框架</a><time datetime="2024-08-16T02:54:34.748Z" title="Created 2024-08-16 02:54:34">2024-08-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/16/graphics/CPP/%E6%8C%87%E9%92%88%E4%B8%8E%E5%BC%95%E7%94%A8%E3%80%81%E6%95%B0%E7%BB%84%E5%89%8D%E7%BC%80%E5%8C%BA%E5%88%AB/" title="No title"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/cover_top_image/Photo%20by%20Aleks%20Marinkovic%20%28jUKpxAfSHlE%29.jpg?_r_=0205adec-5132-a5a5-6541-55d3ced977ea" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="No title"/></a><div class="content"><a class="title" href="/2024/08/16/graphics/CPP/%E6%8C%87%E9%92%88%E4%B8%8E%E5%BC%95%E7%94%A8%E3%80%81%E6%95%B0%E7%BB%84%E5%89%8D%E7%BC%80%E5%8C%BA%E5%88%AB/" title="No title">No title</a><time datetime="2024-08-16T02:54:34.748Z" title="Created 2024-08-16 02:54:34">2024-08-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/16/graphics/opengl/OPENGL%20+%20FFMPEG%20%E5%AE%9E%E7%8E%B0%E5%85%A8%E6%99%AF%E6%92%AD%E6%94%BE%E5%99%A8/" title="OPENGL + FFMPEG 实现全景播放器"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://tryhardzhangblog.oss-us-west-1.aliyuncs.com/cover_top_image/Photo%20by%20Abyan%20Athif%20%28DvYwy0mQdE0%29.jpg?_r_=df9dd8dc-8390-1381-048f-0df0b5876403" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="OPENGL + FFMPEG 实现全景播放器"/></a><div class="content"><a class="title" href="/2024/08/16/graphics/opengl/OPENGL%20+%20FFMPEG%20%E5%AE%9E%E7%8E%B0%E5%85%A8%E6%99%AF%E6%92%AD%E6%94%BE%E5%99%A8/" title="OPENGL + FFMPEG 实现全景播放器">OPENGL + FFMPEG 实现全景播放器</a><time datetime="2024-08-16T02:54:34.748Z" title="Created 2024-08-16 02:54:34">2024-08-16</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="51la统计" target="_blank" rel="noopener" href="https://v6.51.la/">51la统计</a><a class="footer-item" title="十年之约" target="_blank" rel="noopener" href="https://www.foreverblog.cn/">十年之约</a><a class="footer-item" title="开往" target="_blank" rel="noopener" href="https://github.com/travellings-link/travellings">开往</a></div></div><div class="footer-group"><div class="footer-title">主题</div><div class="footer-links"><a class="footer-item" title="文档" href="/docs/">文档</a><a class="footer-item" title="源码" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu">源码</a><a class="footer-item" title="更新日志" href="/update/">更新日志</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="即刻短文" href="/essay/">即刻短文</a><a class="footer-item" title="友链文章" href="/fcircle/">友链文章</a><a class="footer-item" title="留言板" href="/comments/">留言板</a></div></div><div class="footer-group"><div class="footer-title">协议</div><div class="footer-links"><a class="footer-item" title="隐私协议" href="/privacy/">隐私协议</a><a class="footer-item" title="Cookies" href="/cookies/">Cookies</a><a class="footer-item" title="版权协议" href="/copyright/">版权协议</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="Edmend Zhang" target="_blank">Edmend Zhang</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">Articles</div><div class="length-num">37</div></a><a href="/tags/" title="tag"><div class="headline">Tags</div><div class="length-num">20</div></a><a href="/categories/" title="category"><div class="headline">Categories</div><div class="length-num">12</div></a></div><span class="sidebar-menu-item-title">Function</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="Display Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>Display Mode</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.tryhardzhang.xyz/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.tryhardzhang.xyz/" title="none"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="none"/><span class="back-menu-item-text">none</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 想法</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?id=9570676565&amp;server=netease"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Docker/" style="font-size: 0.88rem;">Docker<sup>2</sup></a><a href="/tags/Games101/" style="font-size: 0.88rem;">Games101<sup>2</sup></a><a href="/tags/Graphics/" style="font-size: 0.88rem;">Graphics<sup>14</sup></a><a href="/tags/Graphics-Games101/" style="font-size: 0.88rem;">Graphics - Games101<sup>1</sup></a><a href="/tags/Home-Assistant-%E9%9B%86%E6%88%90-Frigate-%E5%8A%9F%E8%83%BD%E5%B1%95%E7%A4%BA/" style="font-size: 0.88rem;">Home Assistant 集成 Frigate 功能展示<sup>1</sup></a><a href="/tags/HomeAssistant/" style="font-size: 0.88rem;">HomeAssistant<sup>1</sup></a><a href="/tags/RTP/" style="font-size: 0.88rem;">RTP<sup>1</sup></a><a href="/tags/RTSP/" style="font-size: 0.88rem;">RTSP<sup>3</sup></a><a href="/tags/UE5/" style="font-size: 0.88rem;">UE5<sup>1</sup></a><a href="/tags/VCPKG/" style="font-size: 0.88rem;">VCPKG<sup>1</sup></a><a href="/tags/concepts/" style="font-size: 0.88rem;">concepts<sup>2</sup></a><a href="/tags/csen-272/" style="font-size: 0.88rem;">csen 272<sup>2</sup></a><a href="/tags/live555/" style="font-size: 0.88rem;">live555<sup>1</sup></a><a href="/tags/nlp/" style="font-size: 0.88rem;">nlp<sup>2</sup></a><a href="/tags/search/" style="font-size: 0.88rem;">search<sup>2</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 0.88rem;">博客<sup>1</sup></a><a href="/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/" style="font-size: 0.88rem;">虚拟机<sup>1</sup></a><a href="/tags/%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE%E5%99%A8/" style="font-size: 0.88rem;">视频播放器<sup>1</sup></a><a href="/tags/%E8%A7%86%E9%A2%91%E6%B5%81%E4%BC%A0%E8%BE%93/" style="font-size: 0.88rem;">视频流传输<sup>1</sup></a><a href="/tags/%E8%AF%BE%E7%A8%8B/" style="font-size: 0.88rem;">课程<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="9570676565" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://music.163.com/#/playlist?id=9570676565&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Edmend Zhang 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://tryhardzhang.netlify.app/.netlify/functions/twikoo',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://tryhardzhang.netlify.app/.netlify/functions/twikoo',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[image]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[link]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[code]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://tryhardzhang.netlify.app/.netlify/functions/twikoo',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "Unable to get the data, please make sure the settings are correct."
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += 'No Comment'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>